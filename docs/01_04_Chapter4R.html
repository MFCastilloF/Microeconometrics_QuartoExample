<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.2.335">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Microeconometrics: Methods and Applications - 6&nbsp; Chapter 4</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1.6em;
  vertical-align: middle;
}
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
}
.hanging div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}
</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<link href="./02_00_FollowingStata.html" rel="next">
<link href="./01_03_Chapter3R.html" rel="prev">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit"
  }
}</script>

  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

</head>

<body class="nav-sidebar floating">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
    <div class="container-fluid d-flex justify-content-between">
      <h1 class="quarto-secondary-nav-title"><span class="chapter-title">Chapter 4</span></h1>
      <button type="button" class="quarto-btn-toggle btn" aria-label="Show secondary navigation">
        <i class="bi bi-chevron-right"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse sidebar-navigation floating overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="./">Microeconometrics: Methods and Applications</a> 
        <div class="sidebar-tools-main">
    <a href="https://github.com/damiancclarke" title="Source Code" class="sidebar-tool px-1"><i class="bi bi-github"></i></a>
    <a href="" title="Download" id="sidebar-tool-dropdown-0" class="sidebar-tool dropdown-toggle px-1" data-bs-toggle="dropdown" aria-expanded="false"><i class="bi bi-download"></i></a>
    <ul class="dropdown-menu" aria-labelledby="sidebar-tool-dropdown-0">
        <li>
          <a class="dropdown-item sidebar-tools-main-item" href="./Microeconometrics--Methods-and-Applications.pdf">
            <i class="bi bi-bi-file-pdf pe-1"></i>
          Download PDF
          </a>
        </li>
        <li>
          <a class="dropdown-item sidebar-tools-main-item" href="./Microeconometrics--Methods-and-Applications.epub">
            <i class="bi bi-bi-journal pe-1"></i>
          Download ePub
          </a>
        </li>
    </ul>
</div>
    </div>
      </div>
      <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
      </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="./index.html" class="sidebar-item-text sidebar-link">Introduction</a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="true">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./00_01_About.html" class="sidebar-item-text sidebar-link"><span class="chapter-title">About this book</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./00_02_Download.html" class="sidebar-item-text sidebar-link"><span class="chapter-title">How to download the required data</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="./01_00_FollowingR.html" class="sidebar-item-text sidebar-link">Following Along with R</a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" aria-expanded="true">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./01_01_IntroductionR.html" class="sidebar-item-text sidebar-link"><span class="chapter-title">An Introduction to R</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./01_02_Chapter2R.html" class="sidebar-item-text sidebar-link"><span class="chapter-title">Chapter 2</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./01_03_Chapter3R.html" class="sidebar-item-text sidebar-link"><span class="chapter-title">Details required for Chapter 3</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./01_04_Chapter4R.html" class="sidebar-item-text sidebar-link active"><span class="chapter-title">Chapter 4</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="./02_00_FollowingStata.html" class="sidebar-item-text sidebar-link">Following Along with Stata</a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" aria-expanded="true">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-3" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./02_01_IntroductionStata.html" class="sidebar-item-text sidebar-link"><span class="chapter-title">An Introduction to Stata</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./02_02_Chapter2Stata.html" class="sidebar-item-text sidebar-link"><span class="chapter-title">Details required for Chapter 2</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./02_03_Chapter3Stata.html" class="sidebar-item-text sidebar-link"><span class="chapter-title">Details required for Chapter 3</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="./03_00_FollowingPython.html" class="sidebar-item-text sidebar-link">Following Along with Python</a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" aria-expanded="true">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-4" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./03_01_IntroductionPython.html" class="sidebar-item-text sidebar-link"><span class="chapter-title">An Introduction to Python</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./03_02_Chapter2Python.html" class="sidebar-item-text sidebar-link"><span class="chapter-title">3.2 – Details required for Chapter 2</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./03_03_Chapter3Python.html" class="sidebar-item-text sidebar-link"><span class="chapter-title">Details required for Chapter 3</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./06_references.html" class="sidebar-item-text sidebar-link"><span class="chapter-title">References</span></a>
  </div>
</li>
    </ul>
    </div>
</nav>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#tools-required-for-chapter-4" id="toc-tools-required-for-chapter-4" class="nav-link active" data-scroll-target="#tools-required-for-chapter-4">Tools required for Chapter 4</a></li>
  <li><a href="#code-call-out-4.1" id="toc-code-call-out-4.1" class="nav-link" data-scroll-target="#code-call-out-4.1">Code Call Out 4.1</a>
  <ul class="collapse">
  <li><a href="#the-two-way-fixed-effect-estimator" id="toc-the-two-way-fixed-effect-estimator" class="nav-link" data-scroll-target="#the-two-way-fixed-effect-estimator">The Two-way Fixed Effect Estimator</a></li>
  <li><a href="#goodmanbacon2018-decomposition" id="toc-goodmanbacon2018-decomposition" class="nav-link" data-scroll-target="#goodmanbacon2018-decomposition"><span class="citation" data-cites="GoodmanBacon2018">Goodman-Bacon (2021)</span> Decomposition</a></li>
  <li><a href="#dechaisemartindhaultfoeuille2019s-procedure" id="toc-dechaisemartindhaultfoeuille2019s-procedure" class="nav-link" data-scroll-target="#dechaisemartindhaultfoeuille2019s-procedure"><span class="citation" data-cites="deChaisemartinDhaultfoeuille2019">Chaisemartin and D’Haultfoeuille (2020)</span>’s Procedure</a></li>
  </ul></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title d-none d-lg-block"><span class="chapter-title">Chapter 4</span></h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  

</header>

<div class="cell">

</div>
<section id="tools-required-for-chapter-4" class="level2">
<h2 class="anchored" data-anchor-id="tools-required-for-chapter-4">Tools required for Chapter 4</h2>
</section>
<section id="code-call-out-4.1" class="level2">
<h2 class="anchored" data-anchor-id="code-call-out-4.1">Code Call Out 4.1</h2>
<p><strong>Two-Way Fixed Effects Estimators and Heterogeneous Treatment Effects</strong> To understand the potential issues related to heterogeneous treatment effects over time and two-way fixed effect estimators, we will examine a pair of numerical examples. In particular, we will focus on the composition of the two way FE estimator <span class="math inline">\(\tau\)</span> estimated from: <span id="eq-twfe"><span class="math display">\[
y_{st} = \gamma_s + \lambda_t + \tau w_{st} + \varepsilon_{st}
\tag{6.1}\]</span></span> where <span class="math inline">\(y_{st}\)</span> is the outcome variable, <span class="math inline">\(\gamma_s\)</span> and <span class="math inline">\(\lambda_t\)</span> are state (unit) and time fixed effects, <span class="math inline">\(w_{st}\)</span> is the binary treatment variable that takes the value of 1 if a state (unit) <span class="math inline">\(s\)</span> is treated at time <span class="math inline">\(t\)</span> and otherwise takes 0. We will work with a quite tractable example based on three units and 10 time periods, and will document how the approaches taken by <span class="citation" data-cites="GoodmanBacon2018">Goodman-Bacon (<a href="06_references.html#ref-GoodmanBacon2018" role="doc-biblioref">2021</a>)</span> and by <span class="citation" data-cites="deChaisemartinDhaultfoeuille2019">Chaisemartin and D’Haultfoeuille (<a href="06_references.html#ref-deChaisemartinDhaultfoeuille2019" role="doc-biblioref">2020</a>)</span> to understand the two-way FE estimator compare.</p>
<p>The results from <span class="citation" data-cites="GoodmanBacon2018">Goodman-Bacon (<a href="06_references.html#ref-GoodmanBacon2018" role="doc-biblioref">2021</a>)</span> and those from <span class="citation" data-cites="deChaisemartinDhaultfoeuille2019">Chaisemartin and D’Haultfoeuille (<a href="06_references.html#ref-deChaisemartinDhaultfoeuille2019" role="doc-biblioref">2020</a>)</span> are similar, however they take quite different paths to get there. Goodman-Bacon’s (like that laid out in <span class="citation" data-cites="AtheyImbens2018">Athey and Imbens (<a href="06_references.html#ref-AtheyImbens2018" role="doc-biblioref">2022</a>)</span>) is “mechanical” in that it is based on the underlying difference-in-differences comparisons between all groups. The result in <span class="citation" data-cites="deChaisemartinDhaultfoeuille2019">Chaisemartin and D’Haultfoeuille (<a href="06_references.html#ref-deChaisemartinDhaultfoeuille2019" role="doc-biblioref">2020</a>)</span> is based on a potential outcomes frame-work, and counterfactuals under parallel trend assumptions. Thus to examine how these methods work requires somewhat different frameworks. In the case of <span class="citation" data-cites="GoodmanBacon2018">Goodman-Bacon (<a href="06_references.html#ref-GoodmanBacon2018" role="doc-biblioref">2021</a>)</span>, we should consider all possible DD comparisons, while in the case of <span class="citation" data-cites="deChaisemartinDhaultfoeuille2019">Chaisemartin and D’Haultfoeuille (<a href="06_references.html#ref-deChaisemartinDhaultfoeuille2019" role="doc-biblioref">2020</a>)</span> we should consider the treatment effect for each unit and time period, which requires knowing the observed and counterfactual state. While the approaches the two papers take to understand the content of the estimator differ, they refer to the same estimator, so always recover the same parameter estimate. To examine this in a more applied way, we will look at a simulated example.</p>
<p>To do this, let’s consider a panel of 3 states/areas over the 10 years (<span class="math inline">\(t\)</span>) of 2000 to 2009. One of these units is entirely untreated (<span class="math inline">\(unit = 1\)</span> or group <span class="math inline">\(U\)</span>), one is treated at an early time period, 2003, (<span class="math inline">\(unit = 2\)</span> or group <span class="math inline">\(k\)</span>), and the other is treated at a later time period, 2006, (<span class="math inline">\(unit = 3\)</span> or group <span class="math inline">\(l\)</span>). We will construct a general structure for this data below:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a>Data <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">unit =</span> <span class="fu">ceiling</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">30</span><span class="sc">/</span><span class="dv">10</span>), <span class="at">year =</span> <span class="fu">rep</span>(<span class="dv">2000</span><span class="sc">:</span><span class="dv">2009</span>, <span class="dv">3</span>))</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(Data)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  unit year
1    1 2000
2    1 2001
3    1 2002
4    1 2003
5    1 2004
6    1 2005</code></pre>
</div>
</div>
<p>We will consider a simple-case where the actual data-generating process is known as: <span class="math display">\[y_{unit,t} = 2 + 0.2 \times (t - 2000) + 1 \times unit + \beta_1 \times post \times unit + \beta_2 \times post \times unit \times (t - treat).\]</span> Here <span class="math inline">\(unit\)</span> refers to the unit number listed above (1, 2 or 3), <span class="math inline">\(post\)</span> indicates that a unit is receiving treatment in the relevant time period <span class="math inline">\(t\)</span>, and <span class="math inline">\(treat\)</span> refers to the treatment period (2003 for unit 2, and 2006 for unit 3). Let’s generate treatment, time to treatment, and post-treatment variables in <code>R</code>:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a>Data<span class="sc">$</span>treat <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(Data<span class="sc">$</span>unit <span class="sc">==</span> <span class="dv">2</span>, <span class="dv">2006</span>, <span class="fu">ifelse</span>(Data<span class="sc">$</span>unit <span class="sc">==</span> <span class="dv">3</span>, <span class="dv">2003</span>, <span class="dv">0</span>))</span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>Data<span class="sc">$</span>time  <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(Data<span class="sc">$</span>treat <span class="sc">==</span> <span class="dv">0</span>, <span class="dv">0</span>, Data<span class="sc">$</span>year <span class="sc">-</span> Data<span class="sc">$</span>treat)</span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>Data<span class="sc">$</span>post  <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(Data<span class="sc">$</span>time <span class="sc">&gt;=</span> <span class="dv">0</span> <span class="sc">&amp;</span> Data<span class="sc">$</span>treat <span class="sc">!=</span> <span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">0</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>This specification allows for each unit to have its own fixed effect, given that <span class="math inline">\(unit\)</span> is multiplied by 1, and allows for a general time trend increasing by 0.2 units each period across the whole sample. These parameters are not so important, as what we care about are the treatment effects themselves. The impact of treatment comes from the units <span class="math inline">\(\beta_1\)</span> and <span class="math inline">\(\beta_2\)</span>. The first of these, <span class="math inline">\(\beta_1\)</span>, captures an immediate unit-specific jump when treatment is implemented which remains stable over time. The second of these, <span class="math inline">\(\beta_2\)</span>, implies a trend break occurring <em>only</em> for the treated units once treatment comes into place. We will consider 2 cases below. In the first case <span class="math inline">\(\beta_1 = 1\)</span> and <span class="math inline">\(\beta_2 = 0\)</span> (a simple case with a constant treatment effect per unit):</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>Data<span class="sc">$</span>y1 <span class="ot">&lt;-</span> <span class="dv">2</span> <span class="sc">+</span> (Data<span class="sc">$</span>year <span class="sc">-</span> <span class="dv">2000</span>) <span class="sc">*</span> <span class="fl">0.2</span> <span class="sc">+</span> <span class="dv">1</span> <span class="sc">*</span> Data<span class="sc">$</span>unit <span class="sc">+</span> <span class="dv">1</span> <span class="sc">*</span> Data<span class="sc">$</span>post <span class="sc">*</span> Data<span class="sc">$</span>unit <span class="sc">+</span> </span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>  <span class="dv">0</span> <span class="sc">*</span> Data<span class="sc">$</span>post <span class="sc">*</span> Data<span class="sc">$</span>unit <span class="sc">*</span> (Data<span class="sc">$</span>time)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>and in a second case <span class="math inline">\(\beta_1 = 1\)</span> and <span class="math inline">\(\beta_2 = 0.45\)</span>. This is a more complex case in which there are heterogeneous treatment effects over time:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a>Data<span class="sc">$</span>y2 <span class="ot">&lt;-</span> <span class="dv">2</span> <span class="sc">+</span> (Data<span class="sc">$</span>year <span class="sc">-</span> <span class="dv">2000</span>) <span class="sc">*</span> <span class="fl">0.2</span> <span class="sc">+</span> <span class="dv">1</span> <span class="sc">*</span> Data<span class="sc">$</span>unit <span class="sc">+</span> <span class="dv">1</span> <span class="sc">*</span> Data<span class="sc">$</span>post <span class="sc">*</span> Data<span class="sc">$</span>unit <span class="sc">+</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>  <span class="fl">0.45</span> <span class="sc">*</span> Data<span class="sc">$</span>post <span class="sc">*</span> Data<span class="sc">$</span>unit <span class="sc">*</span> (Data<span class="sc">$</span>time)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>These two cases are plotted next where the line with empty circles refers to group <span class="math inline">\(U\)</span>, the line with black filled circles refers to group <span class="math inline">\(k\)</span> and the line with squares refers to group <span class="math inline">\(l\)</span></p>
<div class="cell">
<details>
<summary>Show the plot code</summary>
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggpubr)</span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a>p1 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(<span class="at">data =</span> Data, <span class="fu">aes</span>(<span class="at">x =</span> year, <span class="at">y =</span> y1, <span class="at">color =</span> <span class="fu">as.factor</span>(unit))) <span class="sc">+</span></span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">linetype =</span> <span class="dv">1</span>, <span class="at">size =</span> <span class="fl">0.5</span>) <span class="sc">+</span></span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">shape =</span> <span class="fu">as.factor</span>(unit)), <span class="at">size =</span> <span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_shape_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">16</span>, <span class="dv">12</span>)) <span class="sc">+</span></span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">"black"</span>, <span class="st">"black"</span>, <span class="st">"black"</span>)) <span class="sc">+</span></span>
<span id="cb6-8"><a href="#cb6-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"Time"</span>, <span class="at">y =</span> <span class="st">"Outcome Variable"</span>) <span class="sc">+</span></span>
<span id="cb6-9"><a href="#cb6-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">breaks =</span> <span class="fu">seq</span>(<span class="at">from =</span> <span class="dv">2000</span>, <span class="at">to =</span> <span class="dv">2009</span>, <span class="at">by =</span> <span class="dv">2</span>)) <span class="sc">+</span></span>
<span id="cb6-10"><a href="#cb6-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">breaks =</span> <span class="fu">seq</span>(<span class="at">from =</span> <span class="dv">0</span>, <span class="at">to =</span> <span class="dv">12</span>, <span class="at">by =</span> <span class="dv">2</span>),</span>
<span id="cb6-11"><a href="#cb6-11" aria-hidden="true" tabindex="-1"></a>                     <span class="at">labels =</span> <span class="fu">seq</span>(<span class="at">from =</span> <span class="dv">0</span>, <span class="at">to =</span> <span class="dv">12</span>, <span class="at">by =</span> <span class="dv">2</span>),</span>
<span id="cb6-12"><a href="#cb6-12" aria-hidden="true" tabindex="-1"></a>                     <span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">12</span>)) <span class="sc">+</span></span>
<span id="cb6-13"><a href="#cb6-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> <span class="dv">2002</span>, <span class="at">color =</span> <span class="st">"red"</span>, <span class="at">linetype =</span> <span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb6-14"><a href="#cb6-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> <span class="dv">2005</span>, <span class="at">color =</span> <span class="st">"red"</span>, <span class="at">linetype =</span> <span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb6-15"><a href="#cb6-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"none"</span>)</span>
<span id="cb6-16"><a href="#cb6-16" aria-hidden="true" tabindex="-1"></a>t1 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>() <span class="sc">+</span> <span class="fu">geom_text</span>(<span class="fu">aes</span>(<span class="at">x =</span> <span class="dv">0</span>, <span class="at">y =</span> <span class="dv">0</span>, <span class="at">label =</span> <span class="st">"(a) Simple Decomposition"</span>)) <span class="sc">+</span></span>
<span id="cb6-17"><a href="#cb6-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_void</span>()</span>
<span id="cb6-18"><a href="#cb6-18" aria-hidden="true" tabindex="-1"></a>p2 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(<span class="at">data =</span> Data, <span class="fu">aes</span>(<span class="at">x =</span> year, <span class="at">y =</span> y2, <span class="at">color =</span> <span class="fu">as.factor</span>(unit))) <span class="sc">+</span></span>
<span id="cb6-19"><a href="#cb6-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">linetype =</span> <span class="dv">1</span>, <span class="at">size =</span> <span class="fl">0.5</span>) <span class="sc">+</span></span>
<span id="cb6-20"><a href="#cb6-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">shape =</span> <span class="fu">as.factor</span>(unit)), <span class="at">size =</span> <span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb6-21"><a href="#cb6-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_shape_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">16</span>, <span class="dv">12</span>)) <span class="sc">+</span></span>
<span id="cb6-22"><a href="#cb6-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">"black"</span>, <span class="st">"black"</span>, <span class="st">"black"</span>)) <span class="sc">+</span></span>
<span id="cb6-23"><a href="#cb6-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"Time"</span>, <span class="at">y =</span> <span class="st">"Outcome Variable"</span>) <span class="sc">+</span></span>
<span id="cb6-24"><a href="#cb6-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">breaks =</span> <span class="fu">seq</span>(<span class="at">from =</span> <span class="dv">2000</span>, <span class="at">to =</span> <span class="dv">2009</span>, <span class="at">by =</span> <span class="dv">2</span>)) <span class="sc">+</span></span>
<span id="cb6-25"><a href="#cb6-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">breaks =</span> <span class="fu">seq</span>(<span class="at">from =</span> <span class="dv">0</span>, <span class="at">to =</span> <span class="dv">20</span>, <span class="at">by =</span> <span class="dv">5</span>),</span>
<span id="cb6-26"><a href="#cb6-26" aria-hidden="true" tabindex="-1"></a>                     <span class="at">labels =</span> <span class="fu">seq</span>(<span class="at">from =</span> <span class="dv">0</span>, <span class="at">to =</span> <span class="dv">20</span>, <span class="at">by =</span> <span class="dv">5</span>),</span>
<span id="cb6-27"><a href="#cb6-27" aria-hidden="true" tabindex="-1"></a>                     <span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">20</span>)) <span class="sc">+</span></span>
<span id="cb6-28"><a href="#cb6-28" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> <span class="dv">2002</span>, <span class="at">color =</span> <span class="st">"red"</span>, <span class="at">linetype =</span> <span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb6-29"><a href="#cb6-29" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> <span class="dv">2005</span>, <span class="at">color =</span> <span class="st">"red"</span>, <span class="at">linetype =</span> <span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb6-30"><a href="#cb6-30" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"none"</span>)</span>
<span id="cb6-31"><a href="#cb6-31" aria-hidden="true" tabindex="-1"></a>t2 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>() <span class="sc">+</span> <span class="fu">geom_text</span>(<span class="fu">aes</span>(<span class="at">x =</span> <span class="dv">0</span>, <span class="at">y =</span> <span class="dv">0</span>, <span class="at">label =</span> <span class="st">"(b) Decomposition with trends"</span>)) <span class="sc">+</span></span>
<span id="cb6-32"><a href="#cb6-32" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_void</span>()</span>
<span id="cb6-33"><a href="#cb6-33" aria-hidden="true" tabindex="-1"></a><span class="fu">ggarrange</span>(<span class="at">plotlist =</span> <span class="fu">list</span>(p1, p2, t1, t2), <span class="at">ncol =</span> <span class="dv">2</span>, <span class="at">nrow =</span> <span class="dv">2</span>, <span class="at">heights =</span> <span class="fu">c</span>(<span class="fl">0.9</span>, <span class="fl">0.1</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="01_04_Chapter4R_files/figure-html/unnamed-chunk-6-1.png" class="img-fluid" width="960"></p>
</div>
</div>
<div class="cell">

</div>
<section id="the-two-way-fixed-effect-estimator" class="level3">
<h3 class="anchored" data-anchor-id="the-two-way-fixed-effect-estimator">The Two-way Fixed Effect Estimator</h3>
<p>First we will estimate the parameter by two-way fixed effects regression. This will provide us with the parameter estimate that both <span class="citation" data-cites="GoodmanBacon2018">Goodman-Bacon (<a href="06_references.html#ref-GoodmanBacon2018" role="doc-biblioref">2021</a>)</span> and <span class="citation" data-cites="deChaisemartinDhaultfoeuille2019">Chaisemartin and D’Haultfoeuille (<a href="06_references.html#ref-deChaisemartinDhaultfoeuille2019" role="doc-biblioref">2020</a>)</span> will construct in a piece-wise fashion. This is done relatively simply in <code>R</code>. We simply estimate <a href="#eq-twfe">Equation&nbsp;<span>6.1</span></a> by linear regression using <code>lm</code> as laid out below:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a>case1 <span class="ot">&lt;-</span> <span class="fu">lm</span>(<span class="at">data =</span> Data,</span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>            <span class="at">formula =</span> y1 <span class="sc">~</span> <span class="fu">factor</span>(unit) <span class="sc">+</span> <span class="fu">factor</span>(year) <span class="sc">+</span> post)</span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a><span class="fu">paste0</span>(<span class="st">"The parameter estimates by two-way fixed effects regression for the "</span>,</span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a>       <span class="st">"case 1 is: "</span>, case1<span class="sc">$</span>coefficients[<span class="st">"post"</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "The parameter estimates by two-way fixed effects regression for the case 1 is: 2.45454545454545"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a>case2 <span class="ot">&lt;-</span> <span class="fu">lm</span>(<span class="at">data =</span> Data,</span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>            <span class="at">formula =</span> y2 <span class="sc">~</span> <span class="fu">factor</span>(unit) <span class="sc">+</span> <span class="fu">factor</span>(year) <span class="sc">+</span> post)</span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a><span class="fu">paste0</span>(<span class="st">"The parameter estimates by two-way fixed effects regression for the "</span>,</span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a>       <span class="st">"case 2 is: "</span>, case2<span class="sc">$</span>coefficients[<span class="st">"post"</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "The parameter estimates by two-way fixed effects regression for the case 2 is: 3.80454545454545"</code></pre>
</div>
</div>
<p>Here we see that the coefficient of interest is 2.454545. We can see that this is between the two unit-specific jumps that occur with treatment (2 and 3). We will see below why it takes this particular weighted average.</p>
</section>
<section id="goodmanbacon2018-decomposition" class="level3">
<h3 class="anchored" data-anchor-id="goodmanbacon2018-decomposition"><span class="citation" data-cites="GoodmanBacon2018">Goodman-Bacon (<a href="06_references.html#ref-GoodmanBacon2018" role="doc-biblioref">2021</a>)</span> Decomposition</h3>
<p>Using the values simulated above, let’s see how the <span class="citation" data-cites="GoodmanBacon2018">Goodman-Bacon (<a href="06_references.html#ref-GoodmanBacon2018" role="doc-biblioref">2021</a>)</span> decomposition allows us to understand estimated treatment effects. We will consider both:<br>
- (a) Simple Decomposition<br>
- (b) Decomposition with trends</p>
<p>The methodology <span class="citation" data-cites="GoodmanBacon2018">Goodman-Bacon (<a href="06_references.html#ref-GoodmanBacon2018" role="doc-biblioref">2021</a>)</span> decomposition suggests that we should calculate all <span class="math inline">\(2 \times 2\)</span> combinations of states and time where post-treatment units are compared to “untreated” unit (laid out at more length in the boo). In this example, this provides four specific effects, which contribute to <span class="math inline">\(\widehat{\tau}\)</span> as a weighted mean. The specific effects desired are:</p>
<ul>
<li>A. <span class="math inline">\(\widehat{\beta}^{2\times2}_{kU}\)</span> from the comparison of the early treated unit with the untreated unit.<br>
</li>
<li>B. <span class="math inline">\(\widehat{\beta}^{2\times2}_{lU}\)</span>, from the comparison of the latter treated unit with the untreated unit.<br>
</li>
<li>C. <span class="math inline">\(\widehat{\beta}^{2\times2,k}_{kl}\)</span>, from the comparison of the early and latter treated units, when the early unit begin to be treated.<br>
</li>
<li>D. <span class="math inline">\(\widehat{\beta}^{2\times2,l}_{kl}\)</span>, from the comparison of the early and latter treated units, when the latter unit begin to be treated.</li>
</ul>
<p>These will then be weighted as laid out in <span class="citation" data-cites="GoodmanBacon2018">Goodman-Bacon (<a href="06_references.html#ref-GoodmanBacon2018" role="doc-biblioref">2021</a>)</span> to provide the regression-based estimate.</p>
<section id="a-simple-decomposition" class="level4">
<h4 class="anchored" data-anchor-id="a-simple-decomposition">(a) Simple Decomposition</h4>
<p>In this case the <span class="citation" data-cites="GoodmanBacon2018">Goodman-Bacon (<a href="06_references.html#ref-GoodmanBacon2018" role="doc-biblioref">2021</a>)</span> methodology estimate <span class="math inline">\(\widehat{\tau}\)</span> weighting the next four DD comparisons</p>
<div class="cell">
<details>
<summary>Show the plot code</summary>
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>p1 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(<span class="at">data =</span> Data, <span class="fu">aes</span>(<span class="at">x =</span> year, <span class="at">y =</span> y1, <span class="at">color =</span> <span class="fu">as.factor</span>(unit))) <span class="sc">+</span></span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">linetype =</span> <span class="dv">1</span>, <span class="at">size =</span> <span class="fl">0.5</span>, <span class="fu">aes</span>(<span class="at">alpha =</span> <span class="fu">as.factor</span>(unit))) <span class="sc">+</span></span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">shape =</span> <span class="fu">as.factor</span>(unit), <span class="at">alpha =</span> <span class="fu">as.factor</span>(unit)), <span class="at">size =</span> <span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_alpha_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="dv">1</span>,<span class="fl">0.1</span>,<span class="dv">1</span>)) <span class="sc">+</span></span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_shape_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">16</span>, <span class="dv">12</span>)) <span class="sc">+</span></span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">"black"</span>, <span class="st">"black"</span>, <span class="st">"black"</span>)) <span class="sc">+</span></span>
<span id="cb11-8"><a href="#cb11-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"Time"</span>, <span class="at">y =</span> <span class="st">"Outcome Variable"</span>) <span class="sc">+</span></span>
<span id="cb11-9"><a href="#cb11-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">breaks =</span> <span class="fu">seq</span>(<span class="at">from =</span> <span class="dv">2000</span>, <span class="at">to =</span> <span class="dv">2009</span>, <span class="at">by =</span> <span class="dv">2</span>)) <span class="sc">+</span></span>
<span id="cb11-10"><a href="#cb11-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">breaks =</span> <span class="fu">seq</span>(<span class="at">from =</span> <span class="dv">0</span>, <span class="at">to =</span> <span class="dv">12</span>, <span class="at">by =</span> <span class="dv">2</span>),</span>
<span id="cb11-11"><a href="#cb11-11" aria-hidden="true" tabindex="-1"></a>                     <span class="at">labels =</span> <span class="fu">seq</span>(<span class="at">from =</span> <span class="dv">0</span>, <span class="at">to =</span> <span class="dv">12</span>, <span class="at">by =</span> <span class="dv">2</span>),</span>
<span id="cb11-12"><a href="#cb11-12" aria-hidden="true" tabindex="-1"></a>                     <span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">12</span>)) <span class="sc">+</span></span>
<span id="cb11-13"><a href="#cb11-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> <span class="dv">2002</span>, <span class="at">color =</span> <span class="st">"red"</span>, <span class="at">linetype =</span> <span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb11-14"><a href="#cb11-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> <span class="dv">2005</span>, <span class="at">color =</span> <span class="st">"red"</span>, <span class="at">linetype =</span> <span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb11-15"><a href="#cb11-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"none"</span>)</span>
<span id="cb11-16"><a href="#cb11-16" aria-hidden="true" tabindex="-1"></a>p2 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(<span class="at">data =</span> Data, <span class="fu">aes</span>(<span class="at">x =</span> year, <span class="at">y =</span> y1, <span class="at">color =</span> <span class="fu">as.factor</span>(unit))) <span class="sc">+</span></span>
<span id="cb11-17"><a href="#cb11-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">linetype =</span> <span class="dv">1</span>, <span class="at">size =</span> <span class="fl">0.5</span>, <span class="fu">aes</span>(<span class="at">alpha =</span> <span class="fu">as.factor</span>(unit))) <span class="sc">+</span></span>
<span id="cb11-18"><a href="#cb11-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">shape =</span> <span class="fu">as.factor</span>(unit), <span class="at">alpha =</span> <span class="fu">as.factor</span>(unit)), <span class="at">size =</span> <span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb11-19"><a href="#cb11-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_alpha_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">1</span>,<span class="fl">0.1</span>)) <span class="sc">+</span></span>
<span id="cb11-20"><a href="#cb11-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_shape_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">16</span>, <span class="dv">12</span>)) <span class="sc">+</span></span>
<span id="cb11-21"><a href="#cb11-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">"black"</span>, <span class="st">"black"</span>, <span class="st">"black"</span>)) <span class="sc">+</span></span>
<span id="cb11-22"><a href="#cb11-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"Time"</span>, <span class="at">y =</span> <span class="st">"Outcome Variable"</span>) <span class="sc">+</span></span>
<span id="cb11-23"><a href="#cb11-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">breaks =</span> <span class="fu">seq</span>(<span class="at">from =</span> <span class="dv">2000</span>, <span class="at">to =</span> <span class="dv">2009</span>, <span class="at">by =</span> <span class="dv">2</span>)) <span class="sc">+</span></span>
<span id="cb11-24"><a href="#cb11-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">breaks =</span> <span class="fu">seq</span>(<span class="at">from =</span> <span class="dv">0</span>, <span class="at">to =</span> <span class="dv">12</span>, <span class="at">by =</span> <span class="dv">2</span>),</span>
<span id="cb11-25"><a href="#cb11-25" aria-hidden="true" tabindex="-1"></a>                     <span class="at">labels =</span> <span class="fu">seq</span>(<span class="at">from =</span> <span class="dv">0</span>, <span class="at">to =</span> <span class="dv">12</span>, <span class="at">by =</span> <span class="dv">2</span>),</span>
<span id="cb11-26"><a href="#cb11-26" aria-hidden="true" tabindex="-1"></a>                     <span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">12</span>)) <span class="sc">+</span></span>
<span id="cb11-27"><a href="#cb11-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> <span class="dv">2002</span>, <span class="at">color =</span> <span class="st">"red"</span>, <span class="at">linetype =</span> <span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb11-28"><a href="#cb11-28" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> <span class="dv">2005</span>, <span class="at">color =</span> <span class="st">"red"</span>, <span class="at">linetype =</span> <span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb11-29"><a href="#cb11-29" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"none"</span>)</span>
<span id="cb11-30"><a href="#cb11-30" aria-hidden="true" tabindex="-1"></a>p3 <span class="ot">&lt;-</span> Data <span class="sc">%&gt;%</span> <span class="fu">filter</span>(year <span class="sc">&lt;</span> <span class="dv">2006</span>) <span class="sc">%&gt;%</span></span>
<span id="cb11-31"><a href="#cb11-31" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> year, <span class="at">y =</span> y1, <span class="at">color =</span> <span class="fu">as.factor</span>(unit))) <span class="sc">+</span></span>
<span id="cb11-32"><a href="#cb11-32" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">linetype =</span> <span class="dv">1</span>, <span class="at">size =</span> <span class="fl">0.5</span>, <span class="fu">aes</span>(<span class="at">alpha =</span> <span class="fu">as.factor</span>(unit))) <span class="sc">+</span></span>
<span id="cb11-33"><a href="#cb11-33" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">shape =</span> <span class="fu">as.factor</span>(unit), <span class="at">alpha =</span> <span class="fu">as.factor</span>(unit)), <span class="at">size =</span> <span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb11-34"><a href="#cb11-34" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_alpha_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="fl">0.1</span>,<span class="dv">1</span>,<span class="dv">1</span>)) <span class="sc">+</span></span>
<span id="cb11-35"><a href="#cb11-35" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_shape_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">16</span>, <span class="dv">12</span>)) <span class="sc">+</span></span>
<span id="cb11-36"><a href="#cb11-36" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">"black"</span>, <span class="st">"black"</span>, <span class="st">"black"</span>)) <span class="sc">+</span></span>
<span id="cb11-37"><a href="#cb11-37" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"Time"</span>, <span class="at">y =</span> <span class="st">"Outcome Variable"</span>) <span class="sc">+</span></span>
<span id="cb11-38"><a href="#cb11-38" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">breaks =</span> <span class="fu">seq</span>(<span class="at">from =</span> <span class="dv">2000</span>, <span class="at">to =</span> <span class="dv">2009</span>, <span class="at">by =</span> <span class="dv">2</span>),</span>
<span id="cb11-39"><a href="#cb11-39" aria-hidden="true" tabindex="-1"></a>                     <span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">2000</span>,<span class="dv">2009</span>)) <span class="sc">+</span></span>
<span id="cb11-40"><a href="#cb11-40" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">breaks =</span> <span class="fu">seq</span>(<span class="at">from =</span> <span class="dv">0</span>, <span class="at">to =</span> <span class="dv">12</span>, <span class="at">by =</span> <span class="dv">2</span>),</span>
<span id="cb11-41"><a href="#cb11-41" aria-hidden="true" tabindex="-1"></a>                     <span class="at">labels =</span> <span class="fu">seq</span>(<span class="at">from =</span> <span class="dv">0</span>, <span class="at">to =</span> <span class="dv">12</span>, <span class="at">by =</span> <span class="dv">2</span>),</span>
<span id="cb11-42"><a href="#cb11-42" aria-hidden="true" tabindex="-1"></a>                     <span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">12</span>)) <span class="sc">+</span></span>
<span id="cb11-43"><a href="#cb11-43" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> <span class="dv">2002</span>, <span class="at">color =</span> <span class="st">"red"</span>, <span class="at">linetype =</span> <span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb11-44"><a href="#cb11-44" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> <span class="dv">2005</span>, <span class="at">color =</span> <span class="st">"red"</span>, <span class="at">linetype =</span> <span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb11-45"><a href="#cb11-45" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"none"</span>)</span>
<span id="cb11-46"><a href="#cb11-46" aria-hidden="true" tabindex="-1"></a>p4 <span class="ot">&lt;-</span> Data <span class="sc">%&gt;%</span> <span class="fu">filter</span>(year <span class="sc">&gt;=</span> <span class="dv">2003</span>) <span class="sc">%&gt;%</span></span>
<span id="cb11-47"><a href="#cb11-47" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> year, <span class="at">y =</span> y1, <span class="at">color =</span> <span class="fu">as.factor</span>(unit))) <span class="sc">+</span></span>
<span id="cb11-48"><a href="#cb11-48" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">linetype =</span> <span class="dv">1</span>, <span class="at">size =</span> <span class="fl">0.5</span>, <span class="fu">aes</span>(<span class="at">alpha =</span> <span class="fu">as.factor</span>(unit))) <span class="sc">+</span></span>
<span id="cb11-49"><a href="#cb11-49" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">shape =</span> <span class="fu">as.factor</span>(unit), <span class="at">alpha =</span> <span class="fu">as.factor</span>(unit)), <span class="at">size =</span> <span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb11-50"><a href="#cb11-50" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_alpha_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="fl">0.1</span>,<span class="dv">1</span>,<span class="dv">1</span>)) <span class="sc">+</span></span>
<span id="cb11-51"><a href="#cb11-51" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_shape_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">16</span>, <span class="dv">12</span>)) <span class="sc">+</span></span>
<span id="cb11-52"><a href="#cb11-52" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">"black"</span>, <span class="st">"black"</span>, <span class="st">"black"</span>)) <span class="sc">+</span></span>
<span id="cb11-53"><a href="#cb11-53" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"Time"</span>, <span class="at">y =</span> <span class="st">"Outcome Variable"</span>) <span class="sc">+</span></span>
<span id="cb11-54"><a href="#cb11-54" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">breaks =</span> <span class="fu">seq</span>(<span class="at">from =</span> <span class="dv">2000</span>, <span class="at">to =</span> <span class="dv">2009</span>, <span class="at">by =</span> <span class="dv">2</span>),</span>
<span id="cb11-55"><a href="#cb11-55" aria-hidden="true" tabindex="-1"></a>                     <span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">2000</span>,<span class="dv">2009</span>)) <span class="sc">+</span></span>
<span id="cb11-56"><a href="#cb11-56" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">breaks =</span> <span class="fu">seq</span>(<span class="at">from =</span> <span class="dv">0</span>, <span class="at">to =</span> <span class="dv">12</span>, <span class="at">by =</span> <span class="dv">2</span>),</span>
<span id="cb11-57"><a href="#cb11-57" aria-hidden="true" tabindex="-1"></a>                     <span class="at">labels =</span> <span class="fu">seq</span>(<span class="at">from =</span> <span class="dv">0</span>, <span class="at">to =</span> <span class="dv">12</span>, <span class="at">by =</span> <span class="dv">2</span>),</span>
<span id="cb11-58"><a href="#cb11-58" aria-hidden="true" tabindex="-1"></a>                     <span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">12</span>)) <span class="sc">+</span></span>
<span id="cb11-59"><a href="#cb11-59" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> <span class="dv">2002</span>, <span class="at">color =</span> <span class="st">"red"</span>, <span class="at">linetype =</span> <span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb11-60"><a href="#cb11-60" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> <span class="dv">2005</span>, <span class="at">color =</span> <span class="st">"red"</span>, <span class="at">linetype =</span> <span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb11-61"><a href="#cb11-61" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"none"</span>)</span>
<span id="cb11-62"><a href="#cb11-62" aria-hidden="true" tabindex="-1"></a>t1 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>() <span class="sc">+</span> </span>
<span id="cb11-63"><a href="#cb11-63" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_text</span>(<span class="fu">aes</span>(<span class="at">x =</span> <span class="dv">0</span>, <span class="at">y =</span> <span class="dv">0</span>, <span class="at">label =</span> <span class="st">"A. Early Group v/s Untreated Group"</span>), <span class="at">size =</span> <span class="dv">3</span>) <span class="sc">+</span></span>
<span id="cb11-64"><a href="#cb11-64" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_void</span>()</span>
<span id="cb11-65"><a href="#cb11-65" aria-hidden="true" tabindex="-1"></a>t2 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>() <span class="sc">+</span> </span>
<span id="cb11-66"><a href="#cb11-66" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_text</span>(<span class="fu">aes</span>(<span class="at">x =</span> <span class="dv">0</span>, <span class="at">y =</span> <span class="dv">0</span>, <span class="at">label =</span> <span class="st">"B. Later Group v/s Untreated Group"</span>), <span class="at">size =</span> <span class="dv">3</span>) <span class="sc">+</span></span>
<span id="cb11-67"><a href="#cb11-67" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_void</span>()</span>
<span id="cb11-68"><a href="#cb11-68" aria-hidden="true" tabindex="-1"></a>t3 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>() <span class="sc">+</span> </span>
<span id="cb11-69"><a href="#cb11-69" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_text</span>(<span class="fu">aes</span>(<span class="at">x =</span> <span class="dv">0</span>, <span class="at">y =</span> <span class="dv">0</span>, <span class="at">label =</span> <span class="st">"C. Early Group v/s Later Group Before 2006"</span>), </span>
<span id="cb11-70"><a href="#cb11-70" aria-hidden="true" tabindex="-1"></a>            <span class="at">size =</span> <span class="dv">3</span>) <span class="sc">+</span></span>
<span id="cb11-71"><a href="#cb11-71" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_void</span>()</span>
<span id="cb11-72"><a href="#cb11-72" aria-hidden="true" tabindex="-1"></a>t4 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>() <span class="sc">+</span> </span>
<span id="cb11-73"><a href="#cb11-73" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_text</span>(<span class="fu">aes</span>(<span class="at">x =</span> <span class="dv">0</span>, <span class="at">y =</span> <span class="dv">0</span>, <span class="at">label =</span> <span class="st">"D. Early Group v/s Later Group After 2003"</span>), </span>
<span id="cb11-74"><a href="#cb11-74" aria-hidden="true" tabindex="-1"></a>            <span class="at">size =</span> <span class="dv">3</span>) <span class="sc">+</span></span>
<span id="cb11-75"><a href="#cb11-75" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_void</span>()</span>
<span id="cb11-76"><a href="#cb11-76" aria-hidden="true" tabindex="-1"></a><span class="fu">ggarrange</span>(<span class="at">plotlist =</span> <span class="fu">list</span>(t1, t2, p1, p2, t3, t4, p3, p4), <span class="at">ncol =</span> <span class="dv">2</span>, <span class="at">nrow =</span> <span class="dv">4</span>, </span>
<span id="cb11-77"><a href="#cb11-77" aria-hidden="true" tabindex="-1"></a>          <span class="at">heights =</span> <span class="fu">c</span>(<span class="fl">0.1</span>, <span class="fl">0.4</span>, <span class="fl">0.1</span>, <span class="fl">0.4</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="01_04_Chapter4R_files/figure-html/unnamed-chunk-9-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell">

</div>
<p>As seen in the plots, in the simple decomposition these effects are constants of 3 and 2 for early and later treated units given that the “treatment effect” is simply <span class="math inline">\(1 \times unit\)</span> in each case.</p>
<section id="a.-early-group-vs-untreated-group" class="level5">
<h5 class="anchored" data-anchor-id="a.-early-group-vs-untreated-group">A. Early Group v/s Untreated Group</h5>
<p>In order to calculate the effects we start making the simple DD comparison of the untreated group <span class="math inline">\(U\)</span> (<span class="math inline">\(unit = 1\)</span>) with the early treated group <span class="math inline">\(k\)</span> (<span class="math inline">\(unit = 3\)</span>) getting <span class="math inline">\(\widehat{\beta}^{2 \times 2}_{kU}\)</span> as <span class="math display">\[\widehat{\beta}^{2 \times 2}_{kU} = \left( \overline{y}_k^{Post(k)} - \overline{y}_k^{Pre(k)} \right) - \left( \overline{y}_U^{Post(k)} - \overline{y}_U^{Pre(k)} \right)\]</span> Where <span class="math inline">\(\overline{y}_k^{Post(k)}\)</span> is the mean of the outcome variable for the early treated group <span class="math inline">\(k\)</span> (<span class="math inline">\(unit = 3\)</span>) posterior to treatment, from 2003, <span class="math inline">\(\overline{y}_k^{Pre(k)}\)</span> is the mean for of the outcome variable for the early treated group <span class="math inline">\(U\)</span> (<span class="math inline">\(unit = 3\)</span>) prior to treatment, (up until 2002), and <span class="math inline">\(\overline{y}_U^{Post(k)}, \overline{y}_U^{Post(k)}\)</span> are the analogous quantities for the untreated group <span class="math inline">\(U\)</span> (<span class="math inline">\(unit = 1\)</span>)</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a>(<span class="fu">mean</span>(Data<span class="sc">$</span>y1[Data<span class="sc">$</span>unit <span class="sc">==</span> <span class="dv">3</span> <span class="sc">&amp;</span> Data<span class="sc">$</span>post <span class="sc">==</span> <span class="dv">1</span>]) <span class="sc">-</span></span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>   <span class="fu">mean</span>(Data<span class="sc">$</span>y1[Data<span class="sc">$</span>unit <span class="sc">==</span> <span class="dv">3</span> <span class="sc">&amp;</span> Data<span class="sc">$</span>post <span class="sc">==</span> <span class="dv">0</span>])) <span class="sc">-</span></span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a>  (<span class="fu">mean</span>(Data<span class="sc">$</span>y1[Data<span class="sc">$</span>unit <span class="sc">==</span> <span class="dv">1</span> <span class="sc">&amp;</span> Data<span class="sc">$</span>year <span class="sc">&gt;=</span> <span class="dv">2003</span>]) <span class="sc">-</span></span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a>     <span class="fu">mean</span>(Data<span class="sc">$</span>y1[Data<span class="sc">$</span>unit <span class="sc">==</span> <span class="dv">1</span> <span class="sc">&amp;</span> Data<span class="sc">$</span>year <span class="sc">&lt;</span> <span class="dv">2003</span>]))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 3</code></pre>
</div>
</div>
<p>This result also can be obtained from the linear regression with the canonical DD formula <span class="math display">\[y_{unit,t} = \alpha_0 + \alpha_1 \times Post(k) + \alpha_2 \times \mathbf{1}(unit = 3) + \beta_{kU}^{2\times2} \times Post(k) \times \mathbf{1}(unit = 3) + \varepsilon_i\]</span> Where <span class="math inline">\(Post(k)\)</span> indicates that the year is equal or greater than the year where the group <span class="math inline">\(k\)</span> (<span class="math inline">\(unit = 3\)</span>) received the treatment (2003) and <span class="math inline">\(\mathbf{1}(unit = 3)\)</span> indicates if the observation is from the early treated group <span class="math inline">\(k\)</span> (<span class="math inline">\(unit = 3\)</span>)</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(<span class="fu">lm</span>(y1 <span class="sc">~</span> <span class="fu">factor</span>(year <span class="sc">&gt;=</span> <span class="dv">2003</span>) <span class="sc">+</span> <span class="fu">factor</span>(unit) <span class="sc">+</span> <span class="fu">factor</span>(year <span class="sc">&gt;=</span> <span class="dv">2003</span>)<span class="sc">:</span><span class="fu">factor</span>(unit), </span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a>           <span class="at">data =</span> Data, <span class="at">subset =</span> (unit <span class="sc">!=</span> <span class="dv">2</span>)))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
lm(formula = y1 ~ factor(year &gt;= 2003) + factor(unit) + factor(year &gt;= 
    2003):factor(unit), data = Data, subset = (unit != 2))

Residuals:
   Min     1Q Median     3Q    Max 
  -0.6   -0.2    0.0    0.2    0.6 

Coefficients:
                                       Estimate Std. Error t value Pr(&gt;|t|)    
(Intercept)                              3.2000     0.2236  14.311 1.54e-10 ***
factor(year &gt;= 2003)TRUE                 1.0000     0.2673   3.742  0.00178 ** 
factor(unit)3                            2.0000     0.3162   6.325 1.01e-05 ***
factor(year &gt;= 2003)TRUE:factor(unit)3   3.0000     0.3780   7.937 6.14e-07 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Residual standard error: 0.3873 on 16 degrees of freedom
Multiple R-squared:  0.9804,    Adjusted R-squared:  0.9767 
F-statistic: 266.1 on 3 and 16 DF,  p-value: 7.35e-14</code></pre>
</div>
</div>
<p>A third way to obtain this is from the next linear regression <span class="math display">\[y_{unit,t} = \alpha_0 + \beta_{kU}^{2 \times 2} \times Post + \sum_{i = 2001}^{2009} \alpha_{i-2000} \times \mathbf{1}(year = i) + \alpha_{10} \times \mathbf{1}(unit = 3) + \varepsilon_i\]</span> Where in this case <span class="math inline">\(Post\)</span> indicates if the unit is treated (note for group <span class="math inline">\(U\)</span> this will be always 0), <span class="math inline">\(\mathbf{1}(year = i)\)</span> indicates if the observation is in period <span class="math inline">\(i \in \{2001, \ldots, 2009\}\)</span> and <span class="math inline">\(\mathbf{1}(unit = 3)\)</span> keep its meaning</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(<span class="fu">lm</span>(y1 <span class="sc">~</span> post <span class="sc">+</span> <span class="fu">factor</span>(year) <span class="sc">+</span> <span class="fu">factor</span>(unit), <span class="at">data =</span> Data, <span class="at">subset =</span> (unit <span class="sc">!=</span> <span class="dv">2</span>)))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
lm(formula = y1 ~ post + factor(year) + factor(unit), data = Data, 
    subset = (unit != 2))

Residuals:
       Min         1Q     Median         3Q        Max 
-2.324e-15 -3.940e-16  0.000e+00  3.940e-16  2.324e-15 

Coefficients:
                  Estimate Std. Error   t value Pr(&gt;|t|)    
(Intercept)      3.000e+00  1.217e-15 2.466e+15   &lt;2e-16 ***
post             3.000e+00  1.454e-15 2.063e+15   &lt;2e-16 ***
factor(year)2001 2.000e-01  1.490e-15 1.342e+14   &lt;2e-16 ***
factor(year)2002 4.000e-01  1.490e-15 2.684e+14   &lt;2e-16 ***
factor(year)2003 6.000e-01  1.658e-15 3.619e+14   &lt;2e-16 ***
factor(year)2004 8.000e-01  1.658e-15 4.825e+14   &lt;2e-16 ***
factor(year)2005 1.000e+00  1.658e-15 6.031e+14   &lt;2e-16 ***
factor(year)2006 1.200e+00  1.658e-15 7.238e+14   &lt;2e-16 ***
factor(year)2007 1.400e+00  1.658e-15 8.444e+14   &lt;2e-16 ***
factor(year)2008 1.600e+00  1.658e-15 9.650e+14   &lt;2e-16 ***
factor(year)2009 1.800e+00  1.658e-15 1.086e+15   &lt;2e-16 ***
factor(unit)3    2.000e+00  1.217e-15 1.644e+15   &lt;2e-16 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Residual standard error: 1.49e-15 on 8 degrees of freedom
Multiple R-squared:      1, Adjusted R-squared:      1 
F-statistic: 5.002e+30 on 11 and 8 DF,  p-value: &lt; 2.2e-16</code></pre>
</div>
</div>
<p>Now we store this result for posterior use</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a>bku <span class="ot">&lt;-</span> <span class="fu">lm</span>(y1 <span class="sc">~</span> post <span class="sc">+</span> <span class="fu">factor</span>(year) <span class="sc">+</span> <span class="fu">factor</span>(unit), <span class="at">data =</span> Data,</span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a>          <span class="at">subset =</span> (unit <span class="sc">!=</span> <span class="dv">2</span>))<span class="sc">$</span>coefficient[<span class="st">"post"</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="b.-later-group-vs-untreated-group" class="level5">
<h5 class="anchored" data-anchor-id="b.-later-group-vs-untreated-group">B. Later Group v/s Untreated Group</h5>
<p>The next DD comparison we calculate is that which compares the later treated group <span class="math inline">\(l\)</span> (<span class="math inline">\(unit = 2\)</span>) with the untreated group <span class="math inline">\(U\)</span> (<span class="math inline">\(unit = 1\)</span>), resulting in <span class="math inline">\(\widehat{\beta}^{2 \times 2}_{lU}\)</span>. As above, we can generate this DD estimate in a number of ways (most simply by double-differencing with means), and this will then be stored.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a>blu <span class="ot">&lt;-</span> <span class="fu">lm</span>(y1 <span class="sc">~</span> post <span class="sc">+</span> <span class="fu">factor</span>(year) <span class="sc">+</span> <span class="fu">factor</span>(unit), <span class="at">data =</span> Data, </span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a>   <span class="at">subset =</span> (unit <span class="sc">!=</span> <span class="dv">3</span>))<span class="sc">$</span>coefficient[<span class="st">"post"</span>]</span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a>blu</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>post 
   2 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a>(<span class="fu">mean</span>(Data<span class="sc">$</span>y1[Data<span class="sc">$</span>unit <span class="sc">==</span> <span class="dv">2</span> <span class="sc">&amp;</span> Data<span class="sc">$</span>post <span class="sc">==</span> <span class="dv">1</span>]) <span class="sc">-</span></span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a>   <span class="fu">mean</span>(Data<span class="sc">$</span>y1[Data<span class="sc">$</span>unit <span class="sc">==</span> <span class="dv">2</span> <span class="sc">&amp;</span> Data<span class="sc">$</span>post <span class="sc">==</span> <span class="dv">0</span>])) <span class="sc">-</span></span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a>  (<span class="fu">mean</span>(Data<span class="sc">$</span>y1[Data<span class="sc">$</span>unit <span class="sc">==</span> <span class="dv">1</span> <span class="sc">&amp;</span> Data<span class="sc">$</span>year <span class="sc">&gt;=</span> <span class="dv">2006</span>]) <span class="sc">-</span></span>
<span id="cb21-4"><a href="#cb21-4" aria-hidden="true" tabindex="-1"></a>     <span class="fu">mean</span>(Data<span class="sc">$</span>y1[Data<span class="sc">$</span>unit <span class="sc">==</span> <span class="dv">1</span> <span class="sc">&amp;</span> Data<span class="sc">$</span>year <span class="sc">&lt;</span> <span class="dv">2006</span>]))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 2</code></pre>
</div>
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(<span class="fu">lm</span>(y1 <span class="sc">~</span> <span class="fu">factor</span>(year <span class="sc">&gt;=</span> <span class="dv">2006</span>) <span class="sc">+</span> <span class="fu">factor</span>(unit) <span class="sc">+</span> <span class="fu">factor</span>(year <span class="sc">&gt;=</span> <span class="dv">2006</span>)<span class="sc">:</span><span class="fu">factor</span>(unit), </span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a>           <span class="at">data =</span> Data, <span class="at">subset =</span> (unit <span class="sc">!=</span> <span class="dv">3</span>)))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
lm(formula = y1 ~ factor(year &gt;= 2006) + factor(unit) + factor(year &gt;= 
    2006):factor(unit), data = Data, subset = (unit != 3))

Residuals:
   Min     1Q Median     3Q    Max 
  -0.5   -0.3    0.0    0.3    0.5 

Coefficients:
                                       Estimate Std. Error t value Pr(&gt;|t|)    
(Intercept)                              3.5000     0.1369  25.560 2.12e-14 ***
factor(year &gt;= 2006)TRUE                 1.0000     0.2165   4.619 0.000285 ***
factor(unit)2                            1.0000     0.1936   5.164 9.42e-05 ***
factor(year &gt;= 2006)TRUE:factor(unit)2   2.0000     0.3062   6.532 6.91e-06 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Residual standard error: 0.3354 on 16 degrees of freedom
Multiple R-squared:  0.9571,    Adjusted R-squared:  0.9491 
F-statistic: 119.1 on 3 and 16 DF,  p-value: 3.726e-11</code></pre>
</div>
</div>
</section>
<section id="c.-early-group-vs-later-group-before-2006" class="level5">
<h5 class="anchored" data-anchor-id="c.-early-group-vs-later-group-before-2006">C. Early Group v/s Later Group Before 2006</h5>
<p>Next we calculate the effects from the DD comparisons of early and later treated groups, up until the later treated group receives treatment (2006). This is: <span class="math display">\[\widehat{\beta}^{2 \times 2, k}_{kl} \equiv \left( \overline{y}^{Mid(k,l)}_{k} - \overline{y}^{Pre(k)}_{k} \right) - \left( \overline{y}^{Mid(k,l)}_{l} - \overline{y}^{Pre(k)}_{l} \right)\]</span> where <span class="math inline">\(\overline{y}^{Mid(k,l)}_{k}\)</span> is the mean of the outcome variable for the early treated group <span class="math inline">\(k\)</span> (<span class="math inline">\(unit = 3\)</span>) in the period between the treatment for the group <span class="math inline">\(k\)</span> and the group <span class="math inline">\(l\)</span> (<span class="math inline">\(unit = 2\)</span>), from 2003 to 2005, <span class="math inline">\(\overline{y}^{Pre(k)}_{k}\)</span> is the mean for of the outcome variable for the early treated group <span class="math inline">\(k\)</span> (<span class="math inline">\(unit = 3\)</span>) previous to treatment, until 2002, and <span class="math inline">\(\overline{y}^{Mid(k,l)}_{l}, \overline{y}^{Pre(k)}_{l}\)</span> are the analogous for the later treated group <span class="math inline">\(l\)</span> (<span class="math inline">\(unit = 2\)</span>)</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a>bklk <span class="ot">&lt;-</span> <span class="fu">lm</span>(y1 <span class="sc">~</span> post <span class="sc">+</span> <span class="fu">factor</span>(year) <span class="sc">+</span> <span class="fu">factor</span>(unit), <span class="at">data =</span> Data,</span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a>   <span class="at">subset =</span> (unit <span class="sc">!=</span> <span class="dv">1</span> <span class="sc">&amp;</span> year <span class="sc">&lt;</span> <span class="dv">2006</span>))<span class="sc">$</span>coefficient[<span class="st">"post"</span>]</span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a>bklk</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>post 
   3 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a>(<span class="fu">mean</span>(Data<span class="sc">$</span>y1[Data<span class="sc">$</span>unit <span class="sc">==</span> <span class="dv">3</span> <span class="sc">&amp;</span> (Data<span class="sc">$</span>year <span class="sc">&gt;=</span> <span class="dv">2003</span> <span class="sc">&amp;</span> Data<span class="sc">$</span>year <span class="sc">&lt;</span> <span class="dv">2006</span>)]) <span class="sc">-</span></span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a>   <span class="fu">mean</span>(Data<span class="sc">$</span>y1[Data<span class="sc">$</span>unit <span class="sc">==</span> <span class="dv">3</span> <span class="sc">&amp;</span> Data<span class="sc">$</span>year <span class="sc">&lt;</span> <span class="dv">2003</span>])) <span class="sc">-</span></span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true" tabindex="-1"></a>  (<span class="fu">mean</span>(Data<span class="sc">$</span>y1[Data<span class="sc">$</span>unit <span class="sc">==</span> <span class="dv">2</span> <span class="sc">&amp;</span> (Data<span class="sc">$</span>year <span class="sc">&gt;=</span> <span class="dv">2003</span> <span class="sc">&amp;</span> Data<span class="sc">$</span>year <span class="sc">&lt;</span> <span class="dv">2006</span>)]) <span class="sc">-</span></span>
<span id="cb27-4"><a href="#cb27-4" aria-hidden="true" tabindex="-1"></a>     <span class="fu">mean</span>(Data<span class="sc">$</span>y1[Data<span class="sc">$</span>unit <span class="sc">==</span> <span class="dv">2</span> <span class="sc">&amp;</span> Data<span class="sc">$</span>year <span class="sc">&lt;</span> <span class="dv">2003</span>]))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 3</code></pre>
</div>
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(<span class="fu">lm</span>(y1 <span class="sc">~</span> <span class="fu">factor</span>(year <span class="sc">&gt;=</span> <span class="dv">2003</span>) <span class="sc">+</span> <span class="fu">factor</span>(unit) <span class="sc">+</span> <span class="fu">factor</span>(year <span class="sc">&gt;=</span> <span class="dv">2003</span>)<span class="sc">:</span><span class="fu">factor</span>(unit), </span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a>           <span class="at">data =</span> Data, <span class="at">subset =</span> (unit <span class="sc">!=</span> <span class="dv">1</span> <span class="sc">&amp;</span> year <span class="sc">&lt;</span> <span class="dv">2006</span>)))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
lm(formula = y1 ~ factor(year &gt;= 2003) + factor(unit) + factor(year &gt;= 
    2003):factor(unit), data = Data, subset = (unit != 1 &amp; year &lt; 
    2006))

Residuals:
   Min     1Q Median     3Q    Max 
  -0.2   -0.2    0.0    0.2    0.2 

Coefficients:
                                       Estimate Std. Error t value Pr(&gt;|t|)    
(Intercept)                              4.2000     0.1155  36.373 3.58e-10 ***
factor(year &gt;= 2003)TRUE                 0.6000     0.1633   3.674 0.006271 ** 
factor(unit)3                            1.0000     0.1633   6.124 0.000282 ***
factor(year &gt;= 2003)TRUE:factor(unit)3   3.0000     0.2309  12.990 1.17e-06 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Residual standard error: 0.2 on 8 degrees of freedom
Multiple R-squared:  0.9918,    Adjusted R-squared:  0.9887 
F-statistic: 322.7 on 3 and 8 DF,  p-value: 1.106e-08</code></pre>
</div>
</div>
</section>
<section id="d.-early-group-vs-later-group-after-2003" class="level5">
<h5 class="anchored" data-anchor-id="d.-early-group-vs-later-group-after-2003">D. Early Group v/s Later Group After 2003</h5>
<p>The last DD comparison is for early and later treated groups, starting from 2006 <span class="math display">\[\widehat{\beta}^{2 \times 2, l}_{kl} \equiv \left( \overline{y}^{Post(l)}_{l} - \overline{y}^{Mid(k,l)}_{l} \right) - \left( \overline{y}^{Post(l)}_{k} - \overline{y}^{Mid(k,l)}_{k} \right)\]</span> Where <span class="math inline">\(\overline{y}^{Post(l)}_{l}\)</span> is the mean of the outcome variable for the later treated group <span class="math inline">\(l\)</span> (<span class="math inline">\(unit = 2\)</span>) in the period after this group received the treatment, from 2006, <span class="math inline">\(\overline{y}^{Mid(k,l)}_{l}\)</span> is the mean for of the outcome variable for the later treated group <span class="math inline">\(l\)</span> (<span class="math inline">\(unit = 2\)</span>) in the period between the treatment for the group <span class="math inline">\(k\)</span> (<span class="math inline">\(unit = 3\)</span>) and the group <span class="math inline">\(l\)</span>, from 2003 to 2005, and <span class="math inline">\(\overline{y}^{Post(l)}_{k}, \overline{y}^{Mid(k,l)}_{k}\)</span> are the analogous quantities for the early treated group <span class="math inline">\(k\)</span> (<span class="math inline">\(unit = 3\)</span>). We can generate and save this quantity as we have previously:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a>bkll <span class="ot">&lt;-</span> <span class="fu">lm</span>(y1 <span class="sc">~</span> post <span class="sc">+</span> <span class="fu">factor</span>(year) <span class="sc">+</span> <span class="fu">factor</span>(unit), <span class="at">data =</span> Data,</span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a>   <span class="at">subset =</span> (unit <span class="sc">!=</span> <span class="dv">1</span> <span class="sc">&amp;</span> year <span class="sc">&gt;</span> <span class="dv">2002</span>))<span class="sc">$</span>coefficient[<span class="st">"post"</span>]</span>
<span id="cb31-3"><a href="#cb31-3" aria-hidden="true" tabindex="-1"></a>bkll</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>post 
   2 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a>(<span class="fu">mean</span>(Data<span class="sc">$</span>y1[Data<span class="sc">$</span>unit <span class="sc">==</span> <span class="dv">2</span> <span class="sc">&amp;</span> Data<span class="sc">$</span>year <span class="sc">&gt;</span> <span class="dv">2005</span>]) <span class="sc">-</span></span>
<span id="cb33-2"><a href="#cb33-2" aria-hidden="true" tabindex="-1"></a>   <span class="fu">mean</span>(Data<span class="sc">$</span>y1[Data<span class="sc">$</span>unit <span class="sc">==</span> <span class="dv">2</span> <span class="sc">&amp;</span> (Data<span class="sc">$</span>year <span class="sc">&gt;=</span> <span class="dv">2003</span> <span class="sc">&amp;</span> Data<span class="sc">$</span>year <span class="sc">&lt;</span> <span class="dv">2006</span>)])) <span class="sc">-</span></span>
<span id="cb33-3"><a href="#cb33-3" aria-hidden="true" tabindex="-1"></a>  (<span class="fu">mean</span>(Data<span class="sc">$</span>y1[Data<span class="sc">$</span>unit <span class="sc">==</span> <span class="dv">3</span> <span class="sc">&amp;</span> Data<span class="sc">$</span>year <span class="sc">&gt;</span> <span class="dv">2005</span>]) <span class="sc">-</span></span>
<span id="cb33-4"><a href="#cb33-4" aria-hidden="true" tabindex="-1"></a>     <span class="fu">mean</span>(Data<span class="sc">$</span>y1[Data<span class="sc">$</span>unit <span class="sc">==</span> <span class="dv">3</span> <span class="sc">&amp;</span> (Data<span class="sc">$</span>year <span class="sc">&gt;=</span> <span class="dv">2003</span> <span class="sc">&amp;</span> Data<span class="sc">$</span>year <span class="sc">&lt;</span> <span class="dv">2006</span>)]))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 2</code></pre>
</div>
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(<span class="fu">lm</span>(y1 <span class="sc">~</span> <span class="fu">factor</span>(year <span class="sc">&gt;=</span> <span class="dv">2006</span>) <span class="sc">+</span> <span class="fu">factor</span>(unit) <span class="sc">+</span> <span class="fu">factor</span>(year <span class="sc">&gt;=</span> <span class="dv">2006</span>)<span class="sc">:</span><span class="fu">factor</span>(unit<span class="sc">==</span><span class="dv">2</span>), </span>
<span id="cb35-2"><a href="#cb35-2" aria-hidden="true" tabindex="-1"></a>           <span class="at">data =</span> Data, <span class="at">subset =</span> (unit <span class="sc">!=</span> <span class="dv">1</span> <span class="sc">&amp;</span> year <span class="sc">&gt;</span> <span class="dv">2002</span>)))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
lm(formula = y1 ~ factor(year &gt;= 2006) + factor(unit) + factor(year &gt;= 
    2006):factor(unit == 2), data = Data, subset = (unit != 1 &amp; 
    year &gt; 2002))

Residuals:
   Min     1Q Median     3Q    Max 
-0.300 -0.175  0.000  0.175  0.300 

Coefficients: (1 not defined because of singularities)
                                                Estimate Std. Error t value
(Intercept)                                       6.8000     0.2160  31.478
factor(year &gt;= 2006)TRUE                          0.7000     0.1807   3.873
factor(unit)3                                     2.0000     0.1673  11.952
factor(year &gt;= 2006)FALSE:factor(unit == 2)TRUE  -2.0000     0.2556  -7.825
factor(year &gt;= 2006)TRUE:factor(unit == 2)TRUE        NA         NA      NA
                                                Pr(&gt;|t|)    
(Intercept)                                     2.46e-11 ***
factor(year &gt;= 2006)TRUE                         0.00309 ** 
factor(unit)3                                   3.03e-07 ***
factor(year &gt;= 2006)FALSE:factor(unit == 2)TRUE 1.43e-05 ***
factor(year &gt;= 2006)TRUE:factor(unit == 2)TRUE        NA    
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Residual standard error: 0.2366 on 10 degrees of freedom
Multiple R-squared:  0.9868,    Adjusted R-squared:  0.9829 
F-statistic: 249.5 on 3 and 10 DF,  p-value: 1.073e-09</code></pre>
</div>
</div>
<p>This comparison is the comparison which can potentially result in undesired results if treatment effects are dynamic over time because it views group 3 (the previously treated group) as a control. However, in this case, given that treatment effects are homogenous over time we do not have a major problem here, and we observe that <span class="math inline">\(\widehat{\beta}^{2 \times 2, l}_{kl}=2\)</span>.</p>
</section>
<section id="weights" class="level5">
<h5 class="anchored" data-anchor-id="weights">Weights</h5>
<p>We can now arrive to the OLS estimate of this two-way fixed effect model by generating the weighted mean of the previous estimates as: <span class="math display">\[\widehat{\tau} = W_{kU} \cdot \widehat{\beta}^{2\times 2}_{kU} + W_{lU} \cdot \widehat{\beta}^{2\times 2}_{lU} + W_{kl}^{k} \cdot \widehat{\beta}^{2\times 2,k}_{kl} + W_{kl}^{l} \cdot \widehat{\beta}^{2\times 2,l}_{kl}\]</span> Where each <span class="math inline">\(W\)</span> is the weight that the respective <span class="math inline">\(\beta\)</span> has in this weighted mean, specifically: <span class="math display">\[\begin{align*}
W_{kU} &amp; = \frac{(n_k + n_U)^2\widehat{V}^D_{kU}}{\widehat{V}^D} \quad &amp;  \quad W_{lU} &amp; = \frac{(n_l + n_U)^2\widehat{V}^D_{lU}}{\widehat{V}^D} \\
W_{kl}^k &amp; = \frac{[(n_k + n_l)(1 - \overline{D}_l)]^2\widehat{V}^{D,k}_{kl}}{\widehat{V}^D} \quad &amp;  \quad W_{kl}^l &amp; = \frac{[(n_k + n_l)(1 - \overline{D}_k)]^2\widehat{V}^{D,l}_{kl}}{\widehat{V}^D}
\end{align*}\]</span> Where <span class="math inline">\(n\)</span> refers to the sample share of the group</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb37"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a>nk <span class="ot">=</span> <span class="dv">1</span><span class="sc">/</span><span class="dv">3</span></span>
<span id="cb37-2"><a href="#cb37-2" aria-hidden="true" tabindex="-1"></a>nl <span class="ot">=</span> <span class="dv">1</span><span class="sc">/</span><span class="dv">3</span></span>
<span id="cb37-3"><a href="#cb37-3" aria-hidden="true" tabindex="-1"></a>nu <span class="ot">=</span> <span class="dv">1</span><span class="sc">/</span><span class="dv">3</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><span class="math inline">\(\overline{D}\)</span> referes to the share of time the group is treated</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb38"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a>Dk <span class="ot">=</span> <span class="fu">mean</span>(Data<span class="sc">$</span>post[Data<span class="sc">$</span>unit<span class="sc">==</span><span class="dv">3</span>])</span>
<span id="cb38-2"><a href="#cb38-2" aria-hidden="true" tabindex="-1"></a>Dl <span class="ot">=</span> <span class="fu">mean</span>(Data<span class="sc">$</span>post[Data<span class="sc">$</span>unit<span class="sc">==</span><span class="dv">2</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>and <span class="math inline">\(\widehat{V}\)</span> refers to how much treatment varies</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb39"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a>VkU <span class="ot">=</span> <span class="fl">0.5</span><span class="sc">*</span><span class="fl">0.5</span><span class="sc">*</span>(Dk)<span class="sc">*</span>(<span class="dv">1</span><span class="sc">-</span>Dk)</span>
<span id="cb39-2"><a href="#cb39-2" aria-hidden="true" tabindex="-1"></a>VlU <span class="ot">=</span> <span class="fl">0.5</span><span class="sc">*</span><span class="fl">0.5</span><span class="sc">*</span>(Dl)<span class="sc">*</span>(<span class="dv">1</span><span class="sc">-</span>Dl) </span>
<span id="cb39-3"><a href="#cb39-3" aria-hidden="true" tabindex="-1"></a>Vklk <span class="ot">=</span> <span class="fl">0.5</span><span class="sc">*</span><span class="fl">0.5</span><span class="sc">*</span>((Dk<span class="sc">-</span>Dl)<span class="sc">/</span>(<span class="dv">1</span><span class="sc">-</span>Dl))<span class="sc">*</span>((<span class="dv">1</span><span class="sc">-</span>Dk)<span class="sc">/</span>(<span class="dv">1</span><span class="sc">-</span>Dl))</span>
<span id="cb39-4"><a href="#cb39-4" aria-hidden="true" tabindex="-1"></a>Vkll <span class="ot">=</span> <span class="fl">0.5</span><span class="sc">*</span><span class="fl">0.5</span><span class="sc">*</span>(Dl<span class="sc">/</span>Dk)<span class="sc">*</span>((Dk<span class="sc">-</span>Dl)<span class="sc">/</span>(Dk))</span>
<span id="cb39-5"><a href="#cb39-5" aria-hidden="true" tabindex="-1"></a>VD   <span class="ot">=</span> <span class="fu">sum</span>(<span class="fu">lm</span>(post <span class="sc">~</span> <span class="fu">factor</span>(unit) <span class="sc">+</span> <span class="fu">factor</span>(year), </span>
<span id="cb39-6"><a href="#cb39-6" aria-hidden="true" tabindex="-1"></a>              <span class="at">data =</span> Data)<span class="sc">$</span>residuals<span class="sc">^</span><span class="dv">2</span>)<span class="sc">/</span><span class="dv">30</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>The weights are thus the following:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb40"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a>wkU <span class="ot">=</span> ((nk <span class="sc">+</span> nu)<span class="sc">^</span><span class="dv">2</span><span class="sc">*</span>VkU)<span class="sc">/</span>VD</span>
<span id="cb40-2"><a href="#cb40-2" aria-hidden="true" tabindex="-1"></a>wkU</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.3181818</code></pre>
</div>
<div class="sourceCode cell-code" id="cb42"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a>wlU <span class="ot">=</span> ((nl <span class="sc">+</span> nu)<span class="sc">^</span><span class="dv">2</span><span class="sc">*</span>VlU)<span class="sc">/</span>VD</span>
<span id="cb42-2"><a href="#cb42-2" aria-hidden="true" tabindex="-1"></a>wlU</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.3636364</code></pre>
</div>
<div class="sourceCode cell-code" id="cb44"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a>wklk <span class="ot">=</span> (((nk <span class="sc">+</span> nl)<span class="sc">*</span>(<span class="dv">1</span><span class="sc">-</span>Dl))<span class="sc">^</span><span class="dv">2</span><span class="sc">*</span>Vklk)<span class="sc">/</span>VD</span>
<span id="cb44-2"><a href="#cb44-2" aria-hidden="true" tabindex="-1"></a>wklk</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.1363636</code></pre>
</div>
<div class="sourceCode cell-code" id="cb46"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb46-1"><a href="#cb46-1" aria-hidden="true" tabindex="-1"></a>wkll <span class="ot">=</span> (((nk <span class="sc">+</span> nl)<span class="sc">*</span>Dk)<span class="sc">^</span><span class="dv">2</span><span class="sc">*</span>Vkll)<span class="sc">/</span>VD</span>
<span id="cb46-2"><a href="#cb46-2" aria-hidden="true" tabindex="-1"></a>wkll</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.1818182</code></pre>
</div>
</div>
<p>With this in mind the <span class="math inline">\(\tau\)</span> estimate is</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb48"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb48-1"><a href="#cb48-1" aria-hidden="true" tabindex="-1"></a>tau <span class="ot">=</span> wkU <span class="sc">*</span> bku <span class="sc">+</span> wlU <span class="sc">*</span> blu <span class="sc">+</span> wklk <span class="sc">*</span> bklk <span class="sc">+</span> wkll <span class="sc">*</span> bkll</span>
<span id="cb48-2"><a href="#cb48-2" aria-hidden="true" tabindex="-1"></a>tau</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>    post 
2.454545 </code></pre>
</div>
</div>
<p>as observed in the two-way fixed effect estimate above.</p>
</section>
</section>
<section id="b-decomposition-with-trends" class="level4">
<h4 class="anchored" data-anchor-id="b-decomposition-with-trends">(b) Decomposition with trends</h4>
<p>In this case the <span class="citation" data-cites="GoodmanBacon2018">Goodman-Bacon (<a href="06_references.html#ref-GoodmanBacon2018" role="doc-biblioref">2021</a>)</span> decomposition follows as above generating the treatment effect as follows:</p>
<div class="cell">
<details>
<summary>Show the plot code</summary>
<div class="sourceCode cell-code" id="cb50"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb50-1"><a href="#cb50-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb50-2"><a href="#cb50-2" aria-hidden="true" tabindex="-1"></a>p1 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(<span class="at">data =</span> Data, <span class="fu">aes</span>(<span class="at">x =</span> year, <span class="at">y =</span> y2, <span class="at">color =</span> <span class="fu">as.factor</span>(unit))) <span class="sc">+</span></span>
<span id="cb50-3"><a href="#cb50-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">linetype =</span> <span class="dv">1</span>, <span class="at">size =</span> <span class="fl">0.5</span>, <span class="fu">aes</span>(<span class="at">alpha =</span> <span class="fu">as.factor</span>(unit))) <span class="sc">+</span></span>
<span id="cb50-4"><a href="#cb50-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">shape =</span> <span class="fu">as.factor</span>(unit), <span class="at">alpha =</span> <span class="fu">as.factor</span>(unit)), <span class="at">size =</span> <span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb50-5"><a href="#cb50-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_alpha_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="dv">1</span>,<span class="fl">0.1</span>,<span class="dv">1</span>)) <span class="sc">+</span></span>
<span id="cb50-6"><a href="#cb50-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_shape_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">16</span>, <span class="dv">12</span>)) <span class="sc">+</span></span>
<span id="cb50-7"><a href="#cb50-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">"black"</span>, <span class="st">"black"</span>, <span class="st">"black"</span>)) <span class="sc">+</span></span>
<span id="cb50-8"><a href="#cb50-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"Time"</span>, <span class="at">y =</span> <span class="st">"Outcome Variable"</span>) <span class="sc">+</span></span>
<span id="cb50-9"><a href="#cb50-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">breaks =</span> <span class="fu">seq</span>(<span class="at">from =</span> <span class="dv">2000</span>, <span class="at">to =</span> <span class="dv">2009</span>, <span class="at">by =</span> <span class="dv">2</span>)) <span class="sc">+</span></span>
<span id="cb50-10"><a href="#cb50-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">breaks =</span> <span class="fu">seq</span>(<span class="at">from =</span> <span class="dv">0</span>, <span class="at">to =</span> <span class="dv">20</span>, <span class="at">by =</span> <span class="dv">5</span>),</span>
<span id="cb50-11"><a href="#cb50-11" aria-hidden="true" tabindex="-1"></a>                     <span class="at">labels =</span> <span class="fu">seq</span>(<span class="at">from =</span> <span class="dv">0</span>, <span class="at">to =</span> <span class="dv">20</span>, <span class="at">by =</span> <span class="dv">5</span>),</span>
<span id="cb50-12"><a href="#cb50-12" aria-hidden="true" tabindex="-1"></a>                     <span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">20</span>)) <span class="sc">+</span></span>
<span id="cb50-13"><a href="#cb50-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> <span class="dv">2002</span>, <span class="at">color =</span> <span class="st">"red"</span>, <span class="at">linetype =</span> <span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb50-14"><a href="#cb50-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> <span class="dv">2005</span>, <span class="at">color =</span> <span class="st">"red"</span>, <span class="at">linetype =</span> <span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb50-15"><a href="#cb50-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"none"</span>)</span>
<span id="cb50-16"><a href="#cb50-16" aria-hidden="true" tabindex="-1"></a>p2 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(<span class="at">data =</span> Data, <span class="fu">aes</span>(<span class="at">x =</span> year, <span class="at">y =</span> y2, <span class="at">color =</span> <span class="fu">as.factor</span>(unit))) <span class="sc">+</span></span>
<span id="cb50-17"><a href="#cb50-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">linetype =</span> <span class="dv">1</span>, <span class="at">size =</span> <span class="fl">0.5</span>, <span class="fu">aes</span>(<span class="at">alpha =</span> <span class="fu">as.factor</span>(unit))) <span class="sc">+</span></span>
<span id="cb50-18"><a href="#cb50-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">shape =</span> <span class="fu">as.factor</span>(unit), <span class="at">alpha =</span> <span class="fu">as.factor</span>(unit)), <span class="at">size =</span> <span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb50-19"><a href="#cb50-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_alpha_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">1</span>,<span class="fl">0.1</span>)) <span class="sc">+</span></span>
<span id="cb50-20"><a href="#cb50-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_shape_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">16</span>, <span class="dv">12</span>)) <span class="sc">+</span></span>
<span id="cb50-21"><a href="#cb50-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">"black"</span>, <span class="st">"black"</span>, <span class="st">"black"</span>)) <span class="sc">+</span></span>
<span id="cb50-22"><a href="#cb50-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"Time"</span>, <span class="at">y =</span> <span class="st">"Outcome Variable"</span>) <span class="sc">+</span></span>
<span id="cb50-23"><a href="#cb50-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">breaks =</span> <span class="fu">seq</span>(<span class="at">from =</span> <span class="dv">2000</span>, <span class="at">to =</span> <span class="dv">2009</span>, <span class="at">by =</span> <span class="dv">2</span>)) <span class="sc">+</span></span>
<span id="cb50-24"><a href="#cb50-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">breaks =</span> <span class="fu">seq</span>(<span class="at">from =</span> <span class="dv">0</span>, <span class="at">to =</span> <span class="dv">20</span>, <span class="at">by =</span> <span class="dv">5</span>),</span>
<span id="cb50-25"><a href="#cb50-25" aria-hidden="true" tabindex="-1"></a>                     <span class="at">labels =</span> <span class="fu">seq</span>(<span class="at">from =</span> <span class="dv">0</span>, <span class="at">to =</span> <span class="dv">20</span>, <span class="at">by =</span> <span class="dv">5</span>),</span>
<span id="cb50-26"><a href="#cb50-26" aria-hidden="true" tabindex="-1"></a>                     <span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">20</span>)) <span class="sc">+</span></span>
<span id="cb50-27"><a href="#cb50-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> <span class="dv">2002</span>, <span class="at">color =</span> <span class="st">"red"</span>, <span class="at">linetype =</span> <span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb50-28"><a href="#cb50-28" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> <span class="dv">2005</span>, <span class="at">color =</span> <span class="st">"red"</span>, <span class="at">linetype =</span> <span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb50-29"><a href="#cb50-29" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"none"</span>)</span>
<span id="cb50-30"><a href="#cb50-30" aria-hidden="true" tabindex="-1"></a>p3 <span class="ot">&lt;-</span> Data <span class="sc">%&gt;%</span> <span class="fu">filter</span>(year <span class="sc">&lt;</span> <span class="dv">2006</span>) <span class="sc">%&gt;%</span></span>
<span id="cb50-31"><a href="#cb50-31" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> year, <span class="at">y =</span> y2, <span class="at">color =</span> <span class="fu">as.factor</span>(unit))) <span class="sc">+</span></span>
<span id="cb50-32"><a href="#cb50-32" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">linetype =</span> <span class="dv">1</span>, <span class="at">size =</span> <span class="fl">0.5</span>, <span class="fu">aes</span>(<span class="at">alpha =</span> <span class="fu">as.factor</span>(unit))) <span class="sc">+</span></span>
<span id="cb50-33"><a href="#cb50-33" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">shape =</span> <span class="fu">as.factor</span>(unit), <span class="at">alpha =</span> <span class="fu">as.factor</span>(unit)), <span class="at">size =</span> <span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb50-34"><a href="#cb50-34" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_alpha_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="fl">0.1</span>,<span class="dv">1</span>,<span class="dv">1</span>)) <span class="sc">+</span></span>
<span id="cb50-35"><a href="#cb50-35" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_shape_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">16</span>, <span class="dv">12</span>)) <span class="sc">+</span></span>
<span id="cb50-36"><a href="#cb50-36" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">"black"</span>, <span class="st">"black"</span>, <span class="st">"black"</span>)) <span class="sc">+</span></span>
<span id="cb50-37"><a href="#cb50-37" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"Time"</span>, <span class="at">y =</span> <span class="st">"Outcome Variable"</span>) <span class="sc">+</span></span>
<span id="cb50-38"><a href="#cb50-38" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">breaks =</span> <span class="fu">seq</span>(<span class="at">from =</span> <span class="dv">2000</span>, <span class="at">to =</span> <span class="dv">2009</span>, <span class="at">by =</span> <span class="dv">2</span>),</span>
<span id="cb50-39"><a href="#cb50-39" aria-hidden="true" tabindex="-1"></a>                     <span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">2000</span>,<span class="dv">2009</span>)) <span class="sc">+</span></span>
<span id="cb50-40"><a href="#cb50-40" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">breaks =</span> <span class="fu">seq</span>(<span class="at">from =</span> <span class="dv">0</span>, <span class="at">to =</span> <span class="dv">20</span>, <span class="at">by =</span> <span class="dv">5</span>),</span>
<span id="cb50-41"><a href="#cb50-41" aria-hidden="true" tabindex="-1"></a>                     <span class="at">labels =</span> <span class="fu">seq</span>(<span class="at">from =</span> <span class="dv">0</span>, <span class="at">to =</span> <span class="dv">20</span>, <span class="at">by =</span> <span class="dv">5</span>),</span>
<span id="cb50-42"><a href="#cb50-42" aria-hidden="true" tabindex="-1"></a>                     <span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">20</span>)) <span class="sc">+</span></span>
<span id="cb50-43"><a href="#cb50-43" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> <span class="dv">2002</span>, <span class="at">color =</span> <span class="st">"red"</span>, <span class="at">linetype =</span> <span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb50-44"><a href="#cb50-44" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> <span class="dv">2005</span>, <span class="at">color =</span> <span class="st">"red"</span>, <span class="at">linetype =</span> <span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb50-45"><a href="#cb50-45" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"none"</span>)</span>
<span id="cb50-46"><a href="#cb50-46" aria-hidden="true" tabindex="-1"></a>p4 <span class="ot">&lt;-</span> Data <span class="sc">%&gt;%</span> <span class="fu">filter</span>(year <span class="sc">&gt;=</span> <span class="dv">2003</span>) <span class="sc">%&gt;%</span></span>
<span id="cb50-47"><a href="#cb50-47" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> year, <span class="at">y =</span> y2, <span class="at">color =</span> <span class="fu">as.factor</span>(unit))) <span class="sc">+</span></span>
<span id="cb50-48"><a href="#cb50-48" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">linetype =</span> <span class="dv">1</span>, <span class="at">size =</span> <span class="fl">0.5</span>, <span class="fu">aes</span>(<span class="at">alpha =</span> <span class="fu">as.factor</span>(unit))) <span class="sc">+</span></span>
<span id="cb50-49"><a href="#cb50-49" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">shape =</span> <span class="fu">as.factor</span>(unit), <span class="at">alpha =</span> <span class="fu">as.factor</span>(unit)), <span class="at">size =</span> <span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb50-50"><a href="#cb50-50" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_alpha_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="fl">0.1</span>,<span class="dv">1</span>,<span class="dv">1</span>)) <span class="sc">+</span></span>
<span id="cb50-51"><a href="#cb50-51" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_shape_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">16</span>, <span class="dv">12</span>)) <span class="sc">+</span></span>
<span id="cb50-52"><a href="#cb50-52" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">"black"</span>, <span class="st">"black"</span>, <span class="st">"black"</span>)) <span class="sc">+</span></span>
<span id="cb50-53"><a href="#cb50-53" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"Time"</span>, <span class="at">y =</span> <span class="st">"Outcome Variable"</span>) <span class="sc">+</span></span>
<span id="cb50-54"><a href="#cb50-54" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">breaks =</span> <span class="fu">seq</span>(<span class="at">from =</span> <span class="dv">2000</span>, <span class="at">to =</span> <span class="dv">2009</span>, <span class="at">by =</span> <span class="dv">2</span>),</span>
<span id="cb50-55"><a href="#cb50-55" aria-hidden="true" tabindex="-1"></a>                     <span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">2000</span>,<span class="dv">2009</span>)) <span class="sc">+</span></span>
<span id="cb50-56"><a href="#cb50-56" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">breaks =</span> <span class="fu">seq</span>(<span class="at">from =</span> <span class="dv">0</span>, <span class="at">to =</span> <span class="dv">20</span>, <span class="at">by =</span> <span class="dv">5</span>),</span>
<span id="cb50-57"><a href="#cb50-57" aria-hidden="true" tabindex="-1"></a>                     <span class="at">labels =</span> <span class="fu">seq</span>(<span class="at">from =</span> <span class="dv">0</span>, <span class="at">to =</span> <span class="dv">20</span>, <span class="at">by =</span> <span class="dv">5</span>),</span>
<span id="cb50-58"><a href="#cb50-58" aria-hidden="true" tabindex="-1"></a>                     <span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">20</span>)) <span class="sc">+</span></span>
<span id="cb50-59"><a href="#cb50-59" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> <span class="dv">2002</span>, <span class="at">color =</span> <span class="st">"red"</span>, <span class="at">linetype =</span> <span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb50-60"><a href="#cb50-60" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> <span class="dv">2005</span>, <span class="at">color =</span> <span class="st">"red"</span>, <span class="at">linetype =</span> <span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb50-61"><a href="#cb50-61" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"none"</span>)</span>
<span id="cb50-62"><a href="#cb50-62" aria-hidden="true" tabindex="-1"></a>t1 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>() <span class="sc">+</span> </span>
<span id="cb50-63"><a href="#cb50-63" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_text</span>(<span class="fu">aes</span>(<span class="at">x =</span> <span class="dv">0</span>, <span class="at">y =</span> <span class="dv">0</span>, <span class="at">label =</span> <span class="st">"A. Early Group v/s Untreated Group"</span>), <span class="at">size =</span> <span class="dv">3</span>) <span class="sc">+</span></span>
<span id="cb50-64"><a href="#cb50-64" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_void</span>()</span>
<span id="cb50-65"><a href="#cb50-65" aria-hidden="true" tabindex="-1"></a>t2 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>() <span class="sc">+</span> </span>
<span id="cb50-66"><a href="#cb50-66" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_text</span>(<span class="fu">aes</span>(<span class="at">x =</span> <span class="dv">0</span>, <span class="at">y =</span> <span class="dv">0</span>, <span class="at">label =</span> <span class="st">"B. Later Group v/s Untreated Group"</span>), <span class="at">size =</span> <span class="dv">3</span>) <span class="sc">+</span></span>
<span id="cb50-67"><a href="#cb50-67" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_void</span>()</span>
<span id="cb50-68"><a href="#cb50-68" aria-hidden="true" tabindex="-1"></a>t3 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>() <span class="sc">+</span> </span>
<span id="cb50-69"><a href="#cb50-69" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_text</span>(<span class="fu">aes</span>(<span class="at">x =</span> <span class="dv">0</span>, <span class="at">y =</span> <span class="dv">0</span>, <span class="at">label =</span> <span class="st">"C. Early Group v/s Later Group Before 2006"</span>), </span>
<span id="cb50-70"><a href="#cb50-70" aria-hidden="true" tabindex="-1"></a>            <span class="at">size =</span> <span class="dv">3</span>) <span class="sc">+</span></span>
<span id="cb50-71"><a href="#cb50-71" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_void</span>()</span>
<span id="cb50-72"><a href="#cb50-72" aria-hidden="true" tabindex="-1"></a>t4 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>() <span class="sc">+</span> </span>
<span id="cb50-73"><a href="#cb50-73" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_text</span>(<span class="fu">aes</span>(<span class="at">x =</span> <span class="dv">0</span>, <span class="at">y =</span> <span class="dv">0</span>, <span class="at">label =</span> <span class="st">"D. Early Group v/s Later Group After 2003"</span>), </span>
<span id="cb50-74"><a href="#cb50-74" aria-hidden="true" tabindex="-1"></a>            <span class="at">size =</span> <span class="dv">3</span>) <span class="sc">+</span></span>
<span id="cb50-75"><a href="#cb50-75" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_void</span>()</span>
<span id="cb50-76"><a href="#cb50-76" aria-hidden="true" tabindex="-1"></a><span class="fu">ggarrange</span>(<span class="at">plotlist =</span> <span class="fu">list</span>(t1, t2, p1, p2, t3, t4, p3, p4), <span class="at">ncol =</span> <span class="dv">2</span>, <span class="at">nrow =</span> <span class="dv">4</span>, </span>
<span id="cb50-77"><a href="#cb50-77" aria-hidden="true" tabindex="-1"></a>          <span class="at">heights =</span> <span class="fu">c</span>(<span class="fl">0.1</span>, <span class="fl">0.4</span>, <span class="fl">0.1</span>, <span class="fl">0.4</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="01_04_Chapter4R_files/figure-html/unnamed-chunk-23-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell">

</div>
<p>As seen in the plots, in the decomposition with trends these effects are no longer constants of 3 and 2 for early and later treated units given that the “treatment effect” is no longer simply <span class="math inline">\(1 \times unit\)</span> in each case.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb51"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb51-1"><a href="#cb51-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 2X2 DD Regressions</span></span>
<span id="cb51-2"><a href="#cb51-2" aria-hidden="true" tabindex="-1"></a>A <span class="ot">&lt;-</span> <span class="fu">lm</span>(y2 <span class="sc">~</span> post <span class="sc">+</span> <span class="fu">factor</span>(year) <span class="sc">+</span> <span class="fu">factor</span>(unit), <span class="at">data =</span> Data, <span class="at">subset=</span>(unit<span class="sc">!=</span><span class="dv">2</span>))</span>
<span id="cb51-3"><a href="#cb51-3" aria-hidden="true" tabindex="-1"></a>B <span class="ot">&lt;-</span> <span class="fu">lm</span>(y2 <span class="sc">~</span> post <span class="sc">+</span> <span class="fu">factor</span>(year) <span class="sc">+</span> <span class="fu">factor</span>(unit), <span class="at">data =</span> Data, <span class="at">subset=</span>(unit<span class="sc">!=</span><span class="dv">3</span>))</span>
<span id="cb51-4"><a href="#cb51-4" aria-hidden="true" tabindex="-1"></a>C <span class="ot">&lt;-</span> <span class="fu">lm</span>(y2 <span class="sc">~</span> post <span class="sc">+</span> <span class="fu">factor</span>(year) <span class="sc">+</span> <span class="fu">factor</span>(unit), <span class="at">data =</span> Data, <span class="at">subset=</span>(unit<span class="sc">!=</span><span class="dv">1</span> <span class="sc">&amp;</span> year<span class="sc">&lt;</span><span class="dv">2006</span>))</span>
<span id="cb51-5"><a href="#cb51-5" aria-hidden="true" tabindex="-1"></a>D <span class="ot">&lt;-</span> <span class="fu">lm</span>(y2 <span class="sc">~</span> post <span class="sc">+</span> <span class="fu">factor</span>(year) <span class="sc">+</span> <span class="fu">factor</span>(unit), <span class="at">data =</span> Data, <span class="at">subset=</span>(unit<span class="sc">!=</span><span class="dv">1</span> <span class="sc">&amp;</span> year<span class="sc">&gt;</span><span class="dv">2002</span>))</span>
<span id="cb51-6"><a href="#cb51-6" aria-hidden="true" tabindex="-1"></a><span class="co"># 2x2 Betas</span></span>
<span id="cb51-7"><a href="#cb51-7" aria-hidden="true" tabindex="-1"></a>bkUk <span class="ot">&lt;-</span> A<span class="sc">$</span>coefficient[<span class="st">"post"</span>]</span>
<span id="cb51-8"><a href="#cb51-8" aria-hidden="true" tabindex="-1"></a>bkUl <span class="ot">&lt;-</span> B<span class="sc">$</span>coefficient[<span class="st">"post"</span>]</span>
<span id="cb51-9"><a href="#cb51-9" aria-hidden="true" tabindex="-1"></a>bklk <span class="ot">&lt;-</span> C<span class="sc">$</span>coefficient[<span class="st">"post"</span>]</span>
<span id="cb51-10"><a href="#cb51-10" aria-hidden="true" tabindex="-1"></a>bkll <span class="ot">&lt;-</span> D<span class="sc">$</span>coefficient[<span class="st">"post"</span>]</span>
<span id="cb51-11"><a href="#cb51-11" aria-hidden="true" tabindex="-1"></a>bkll</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  post 
-1.375 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb53"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb53-1"><a href="#cb53-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Share of time treated</span></span>
<span id="cb53-2"><a href="#cb53-2" aria-hidden="true" tabindex="-1"></a>Dk <span class="ot">=</span> <span class="fu">mean</span>(Data<span class="sc">$</span>post[Data<span class="sc">$</span>unit<span class="sc">==</span><span class="dv">3</span>])</span>
<span id="cb53-3"><a href="#cb53-3" aria-hidden="true" tabindex="-1"></a>Dl <span class="ot">=</span> <span class="fu">mean</span>(Data<span class="sc">$</span>post[Data<span class="sc">$</span>unit<span class="sc">==</span><span class="dv">2</span>])</span>
<span id="cb53-4"><a href="#cb53-4" aria-hidden="true" tabindex="-1"></a><span class="co"># How much treatment varies</span></span>
<span id="cb53-5"><a href="#cb53-5" aria-hidden="true" tabindex="-1"></a>VkUk <span class="ot">=</span> <span class="fl">0.5</span><span class="sc">*</span><span class="fl">0.5</span><span class="sc">*</span>(Dk)<span class="sc">*</span>(<span class="dv">1</span><span class="sc">-</span>Dk)</span>
<span id="cb53-6"><a href="#cb53-6" aria-hidden="true" tabindex="-1"></a>VkUl <span class="ot">=</span> <span class="fl">0.5</span><span class="sc">*</span><span class="fl">0.5</span><span class="sc">*</span>(Dl)<span class="sc">*</span>(<span class="dv">1</span><span class="sc">-</span>Dl) </span>
<span id="cb53-7"><a href="#cb53-7" aria-hidden="true" tabindex="-1"></a>Vklk <span class="ot">=</span> <span class="fl">0.5</span><span class="sc">*</span><span class="fl">0.5</span><span class="sc">*</span>((Dk<span class="sc">-</span>Dl)<span class="sc">/</span>(<span class="dv">1</span><span class="sc">-</span>Dl))<span class="sc">*</span>((<span class="dv">1</span><span class="sc">-</span>Dk)<span class="sc">/</span>(<span class="dv">1</span><span class="sc">-</span>Dl))</span>
<span id="cb53-8"><a href="#cb53-8" aria-hidden="true" tabindex="-1"></a>Vkll <span class="ot">=</span> <span class="fl">0.5</span><span class="sc">*</span><span class="fl">0.5</span><span class="sc">*</span>(Dl<span class="sc">/</span>Dk)<span class="sc">*</span>((Dk<span class="sc">-</span>Dl)<span class="sc">/</span>(Dk))</span>
<span id="cb53-9"><a href="#cb53-9" aria-hidden="true" tabindex="-1"></a>VD <span class="ot">&lt;-</span> <span class="fu">sum</span>(<span class="fu">lm</span>(post <span class="sc">~</span> <span class="fu">factor</span>(unit) <span class="sc">+</span> <span class="fu">factor</span>(year), <span class="at">data =</span> Data)<span class="sc">$</span>residuals<span class="sc">^</span><span class="dv">2</span><span class="sc">/</span><span class="dv">30</span>)</span>
<span id="cb53-10"><a href="#cb53-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Share of sample</span></span>
<span id="cb53-11"><a href="#cb53-11" aria-hidden="true" tabindex="-1"></a>nk   <span class="ot">=</span> <span class="dv">1</span><span class="sc">/</span><span class="dv">3</span></span>
<span id="cb53-12"><a href="#cb53-12" aria-hidden="true" tabindex="-1"></a>nl   <span class="ot">=</span> <span class="dv">1</span><span class="sc">/</span><span class="dv">3</span></span>
<span id="cb53-13"><a href="#cb53-13" aria-hidden="true" tabindex="-1"></a>nu   <span class="ot">=</span> <span class="dv">1</span><span class="sc">/</span><span class="dv">3</span></span>
<span id="cb53-14"><a href="#cb53-14" aria-hidden="true" tabindex="-1"></a><span class="co"># Weights</span></span>
<span id="cb53-15"><a href="#cb53-15" aria-hidden="true" tabindex="-1"></a>wkUk <span class="ot">=</span> ((nk <span class="sc">+</span> nu)<span class="sc">^</span><span class="dv">2</span><span class="sc">*</span>VkUk)<span class="sc">/</span>VD</span>
<span id="cb53-16"><a href="#cb53-16" aria-hidden="true" tabindex="-1"></a>wkUl <span class="ot">=</span> ((nl <span class="sc">+</span> nu)<span class="sc">^</span><span class="dv">2</span><span class="sc">*</span>VkUl)<span class="sc">/</span>VD</span>
<span id="cb53-17"><a href="#cb53-17" aria-hidden="true" tabindex="-1"></a>wklk <span class="ot">=</span> (((nk <span class="sc">+</span> nl)<span class="sc">*</span>(<span class="dv">1</span><span class="sc">-</span>Dl))<span class="sc">^</span><span class="dv">2</span><span class="sc">*</span>Vklk)<span class="sc">/</span>VD</span>
<span id="cb53-18"><a href="#cb53-18" aria-hidden="true" tabindex="-1"></a>wkll <span class="ot">=</span> (((nk <span class="sc">+</span> nl)<span class="sc">*</span>Dk)<span class="sc">^</span><span class="dv">2</span><span class="sc">*</span>Vkll)<span class="sc">/</span>VD</span>
<span id="cb53-19"><a href="#cb53-19" aria-hidden="true" tabindex="-1"></a><span class="co"># Tau</span></span>
<span id="cb53-20"><a href="#cb53-20" aria-hidden="true" tabindex="-1"></a>tau <span class="ot">=</span> bkUk<span class="sc">*</span>wkUk <span class="sc">+</span> bkUl<span class="sc">*</span>wkUl <span class="sc">+</span> bklk<span class="sc">*</span>wklk <span class="sc">+</span> bkll<span class="sc">*</span>wkll</span>
<span id="cb53-21"><a href="#cb53-21" aria-hidden="true" tabindex="-1"></a>tau</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>    post 
3.804545 </code></pre>
</div>
</div>
<p>What is noteworthy here is the surprising behaviour flagged by <span class="citation" data-cites="GoodmanBacon2018">Goodman-Bacon (<a href="06_references.html#ref-GoodmanBacon2018" role="doc-biblioref">2021</a>)</span> for the final comparison based on the case where the earlier treated unit (unit 3) is used as a control for the later trated unit (unit 2). In this case, given that there <em>are</em> time-varying treatment effects, despite the fact that each unit-specific treatment effect is positive, we observe that the parameter <span class="math inline">\(\widehat{\beta}^{2 \times 2, l}_{kl}\)</span> is actually <em>negative</em>. In this particular example this negative value (-1.375) is not sufficient to turn the weighted treatment effect estimate negative, but if you play around with the size of the parameters <span class="math inline">\(\beta_1\)</span> and <span class="math inline">\(\beta_2\)</span> above, you will see that large enough differences in trends <em>can</em> result in such estimates! Here, as above, we see that when we aggregate unit-specific estimates as <code>tau</code>, the estimate (by definition) agrees with the estimate generated by two-way fixed effect models previously.</p>
</section>
</section>
<section id="dechaisemartindhaultfoeuille2019s-procedure" class="level3">
<h3 class="anchored" data-anchor-id="dechaisemartindhaultfoeuille2019s-procedure"><span class="citation" data-cites="deChaisemartinDhaultfoeuille2019">Chaisemartin and D’Haultfoeuille (<a href="06_references.html#ref-deChaisemartinDhaultfoeuille2019" role="doc-biblioref">2020</a>)</span>’s Procedure</h3>
<p>Now, we will show that the procedures described in <span class="citation" data-cites="deChaisemartinDhaultfoeuille2019">Chaisemartin and D’Haultfoeuille (<a href="06_references.html#ref-deChaisemartinDhaultfoeuille2019" role="doc-biblioref">2020</a>)</span>, despite arriving to the estimator in a different way, also let us understand how the regression weights the two-way fixed effect estimator. The authors define <span class="math inline">\(\widehat{\beta}_{fe}\)</span> as the coefficient estimated in the following (standard) two-way fixed effects regression: <span class="math display">\[y_{i,s,t} = \beta_0 + \beta_{fe} D_{s,t} + \mu_s + \lambda_t + \varepsilon_{s,t}\]</span> Where <span class="math inline">\(D_{s,t}\)</span> is the mean over <span class="math inline">\(i\)</span> of a binary indicator variable that takes value of 1 if the unit <span class="math inline">\(i\)</span> in state <span class="math inline">\(s\)</span> is treated at period <span class="math inline">\(t\)</span> and 0 otherwise, in our case as we have one observartion per state <span class="math inline">\(D_{s,t} = post_{s,t}\)</span>, meanwhile <span class="math inline">\(\mu_s\)</span> and <span class="math inline">\(\lambda_t\)</span> are state and time fixed effects. Following we example with both outcomes</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb55"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb55-1"><a href="#cb55-1" aria-hidden="true" tabindex="-1"></a>case1 <span class="ot">&lt;-</span> <span class="fu">lm</span>(<span class="at">data =</span> Data,</span>
<span id="cb55-2"><a href="#cb55-2" aria-hidden="true" tabindex="-1"></a>            <span class="at">formula =</span> y1 <span class="sc">~</span> <span class="fu">factor</span>(unit) <span class="sc">+</span> <span class="fu">factor</span>(year) <span class="sc">+</span> post)</span>
<span id="cb55-3"><a href="#cb55-3" aria-hidden="true" tabindex="-1"></a><span class="fu">paste0</span>(<span class="st">"The parameter estimates by two-way fixed effects regression for the "</span>,</span>
<span id="cb55-4"><a href="#cb55-4" aria-hidden="true" tabindex="-1"></a>       <span class="st">"case 1 is: "</span>, case1<span class="sc">$</span>coefficients[<span class="st">"post"</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "The parameter estimates by two-way fixed effects regression for the case 1 is: 2.45454545454545"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb57"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb57-1"><a href="#cb57-1" aria-hidden="true" tabindex="-1"></a>case2 <span class="ot">&lt;-</span> <span class="fu">lm</span>(<span class="at">data =</span> Data,</span>
<span id="cb57-2"><a href="#cb57-2" aria-hidden="true" tabindex="-1"></a>            <span class="at">formula =</span> y2 <span class="sc">~</span> <span class="fu">factor</span>(unit) <span class="sc">+</span> <span class="fu">factor</span>(year) <span class="sc">+</span> post)</span>
<span id="cb57-3"><a href="#cb57-3" aria-hidden="true" tabindex="-1"></a><span class="fu">paste0</span>(<span class="st">"The parameter estimates by two-way fixed effects regression for the "</span>,</span>
<span id="cb57-4"><a href="#cb57-4" aria-hidden="true" tabindex="-1"></a>       <span class="st">"case 2 is: "</span>, case2<span class="sc">$</span>coefficients[<span class="st">"post"</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "The parameter estimates by two-way fixed effects regression for the case 2 is: 3.80454545454545"</code></pre>
</div>
</div>
<p>Same as <a href="#eq-twfe">Equation&nbsp;<span>6.1</span></a>. also define the ATE for any (<span class="math inline">\(s,t\)</span>) cell as: <span class="math display">\[\Delta_{s,t} = \frac{1}{N_{s,t}} \sum_{i = 1}^{N_{s,t}}[Y_{i,s,t}(1) - Y_{i,s,t}(0)]\]</span> Next an example for the simple decomposition case. First is created the counterfactual</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb59"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb59-1"><a href="#cb59-1" aria-hidden="true" tabindex="-1"></a>Data<span class="sc">$</span>y1_c <span class="ot">&lt;-</span> <span class="dv">2</span> <span class="sc">+</span> (Data<span class="sc">$</span>year <span class="sc">-</span> <span class="dv">2000</span>) <span class="sc">*</span> <span class="fl">0.2</span> <span class="sc">+</span> <span class="dv">1</span> <span class="sc">*</span> Data<span class="sc">$</span>unit <span class="sc">+</span> <span class="dv">0</span> <span class="sc">*</span> Data<span class="sc">$</span>post <span class="sc">*</span> Data<span class="sc">$</span>unit <span class="sc">+</span> </span>
<span id="cb59-2"><a href="#cb59-2" aria-hidden="true" tabindex="-1"></a>  <span class="dv">0</span> <span class="sc">*</span> Data<span class="sc">$</span>post <span class="sc">*</span> Data<span class="sc">$</span>unit <span class="sc">*</span> (Data<span class="sc">$</span>time)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Next <span class="math inline">\(\Delta_{s,t}\)</span></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb60"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb60-1"><a href="#cb60-1" aria-hidden="true" tabindex="-1"></a>Data<span class="sc">$</span>Delta_st[Data<span class="sc">$</span>post <span class="sc">==</span> <span class="dv">1</span>] <span class="ot">=</span> Data<span class="sc">$</span>y1[Data<span class="sc">$</span>post <span class="sc">==</span> <span class="dv">1</span>] <span class="sc">-</span> Data<span class="sc">$</span>y1_c[Data<span class="sc">$</span>post <span class="sc">==</span> <span class="dv">1</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>One of the key results of <span class="citation" data-cites="deChaisemartinDhaultfoeuille2019">Chaisemartin and D’Haultfoeuille (<a href="06_references.html#ref-deChaisemartinDhaultfoeuille2019" role="doc-biblioref">2020</a>)</span> is to show that under a series of standard assumptions <span class="math display">\[\beta_{fe} = E \left[ \sum_{s,t:D_{s,t}=1}\frac{N_{s,t}}{N_1}w_{s,t}\Delta_{s,t} \right]\]</span> Where <span class="math inline">\(N_1\)</span> refers to the sum of all treated observations and <span class="math display">\[w_{s,t} = \frac{\varepsilon_{s,t}}{\sum_{s,t:D_{s,t}=1}\frac{N_{s,t}}{N_1}\varepsilon_{s,t}}\]</span> Where <span class="math inline">\(\varepsilon_{s,t}\)</span> is the residual from a regression of <span class="math inline">\(D_{s,t}\)</span> on state and time fixed-effects.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb61"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb61-1"><a href="#cb61-1" aria-hidden="true" tabindex="-1"></a>auxreg <span class="ot">&lt;-</span> <span class="fu">lm</span>(post <span class="sc">~</span> <span class="fu">factor</span>(unit) <span class="sc">+</span> <span class="fu">factor</span>(year), <span class="at">data =</span> Data)</span>
<span id="cb61-2"><a href="#cb61-2" aria-hidden="true" tabindex="-1"></a>Data<span class="sc">$</span>eps_st <span class="ot">=</span> auxreg<span class="sc">$</span>residuals</span>
<span id="cb61-3"><a href="#cb61-3" aria-hidden="true" tabindex="-1"></a>Data<span class="sc">$</span>eps_st[Data<span class="sc">$</span>post <span class="sc">!=</span> <span class="dv">1</span>] <span class="ot">=</span> <span class="cn">NA</span></span>
<span id="cb61-4"><a href="#cb61-4" aria-hidden="true" tabindex="-1"></a>Data<span class="sc">$</span>w_st <span class="ot">=</span> Data<span class="sc">$</span>eps_st <span class="sc">/</span> <span class="fu">sum</span>(Data<span class="sc">$</span>eps_st, <span class="at">na.rm =</span> T)</span>
<span id="cb61-5"><a href="#cb61-5" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="fu">paste0</span>(<span class="st">"Clément de Chaisemartin and Xavier D'Haultfoeuille's procudure "</span>,</span>
<span id="cb61-6"><a href="#cb61-6" aria-hidden="true" tabindex="-1"></a>             <span class="st">"gives an estimates of: "</span>, </span>
<span id="cb61-7"><a href="#cb61-7" aria-hidden="true" tabindex="-1"></a>             <span class="fu">sum</span>(Data<span class="sc">$</span>Delta_st<span class="sc">*</span>Data<span class="sc">$</span>w_st, <span class="at">na.rm =</span> T)))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "Clément de Chaisemartin and Xavier D'Haultfoeuille's procudure gives an estimates of: 2.45454545454545"</code></pre>
</div>
</div>
<p>Next you can find the code for the decomposition with trends</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb63"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb63-1"><a href="#cb63-1" aria-hidden="true" tabindex="-1"></a>Data<span class="sc">$</span>y2_c <span class="ot">&lt;-</span> <span class="dv">2</span> <span class="sc">+</span> (Data<span class="sc">$</span>year <span class="sc">-</span> <span class="dv">2000</span>) <span class="sc">*</span> <span class="fl">0.2</span> <span class="sc">+</span> <span class="dv">1</span> <span class="sc">*</span> Data<span class="sc">$</span>unit <span class="sc">+</span> <span class="dv">0</span> <span class="sc">*</span> Data<span class="sc">$</span>post <span class="sc">*</span> Data<span class="sc">$</span>unit <span class="sc">+</span> </span>
<span id="cb63-2"><a href="#cb63-2" aria-hidden="true" tabindex="-1"></a>  <span class="dv">0</span> <span class="sc">*</span> Data<span class="sc">$</span>post <span class="sc">*</span> Data<span class="sc">$</span>unit <span class="sc">*</span> (Data<span class="sc">$</span>time)</span>
<span id="cb63-3"><a href="#cb63-3" aria-hidden="true" tabindex="-1"></a>Data<span class="sc">$</span>Delta_st2[Data<span class="sc">$</span>post <span class="sc">==</span> <span class="dv">1</span>] <span class="ot">=</span> Data<span class="sc">$</span>y2[Data<span class="sc">$</span>post <span class="sc">==</span> <span class="dv">1</span>] <span class="sc">-</span> Data<span class="sc">$</span>y2_c[Data<span class="sc">$</span>post <span class="sc">==</span> <span class="dv">1</span>]</span>
<span id="cb63-4"><a href="#cb63-4" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="fu">paste0</span>(<span class="st">"Clément de Chaisemartin and Xavier D'Haultfoeuille's procudure "</span>,</span>
<span id="cb63-5"><a href="#cb63-5" aria-hidden="true" tabindex="-1"></a>             <span class="st">"gives an estimates of: "</span>, </span>
<span id="cb63-6"><a href="#cb63-6" aria-hidden="true" tabindex="-1"></a>             <span class="fu">sum</span>(Data<span class="sc">$</span>Delta_st2<span class="sc">*</span>Data<span class="sc">$</span>w_st, <span class="at">na.rm =</span> T)))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "Clément de Chaisemartin and Xavier D'Haultfoeuille's procudure gives an estimates of: 3.80454545454545"</code></pre>
</div>
</div>


<div id="refs" class="references csl-bib-body hanging-indent" role="doc-bibliography" style="display: none">
<div id="ref-AtheyImbens2018" class="csl-entry" role="doc-biblioentry">
Athey, Susan, and Guido W. Imbens. 2022. <span>“<span class="nocase">Design-based analysis in Difference-In-Differences settings with staggered adoption</span>.”</span> <em>Journal of Econometrics</em> 226 (1): 62–79. https://doi.org/<a href="https://doi.org/10.1016/j.jeconom.2020.10.012">https://doi.org/10.1016/j.jeconom.2020.10.012</a>.
</div>
<div id="ref-deChaisemartinDhaultfoeuille2019" class="csl-entry" role="doc-biblioentry">
Chaisemartin, Clément de, and Xavier D’Haultfoeuille. 2020. <span>“Two-Way Fixed Effects Estimators with Heterogeneous Treatment Effects.”</span> <em>American Economic Review</em> 110 (9): 2964–96. <a href="https://doi.org/10.1257/aer.20181169">https://doi.org/10.1257/aer.20181169</a>.
</div>
<div id="ref-GoodmanBacon2018" class="csl-entry" role="doc-biblioentry">
Goodman-Bacon, Andrew. 2021. <span>“Difference-in-Differences with Variation in Treatment Timing.”</span> <em>Journal of Econometrics</em> 225 (2): 254–77. https://doi.org/<a href="https://doi.org/10.1016/j.jeconom.2021.03.014">https://doi.org/10.1016/j.jeconom.2021.03.014</a>.
</div>
</div>
</section>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    target: function(trigger) {
      return trigger.previousElementSibling;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="./01_03_Chapter3R.html" class="pagination-link">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-title">Details required for Chapter 3</span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="./02_00_FollowingStata.html" class="pagination-link">
        <span class="nav-page-text">Following Along with Stata</span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->



</body></html>