---
title: "Chapter 4"
bibliography: refs.bib
---

## Synthetic Control Exercise

The synthetic control method seeks to construct a "synthetic control" for a treated unit (in this case, California) using a weighted combination of control units (other states). The aim is for this synthetic control to closely resemble the treated unit in the pre-treatment period based on predictor variables.

-   Use the 'synth' command to construct the synthetic control for California
-   Predictor variables: cigsale from specific years, beer, lnincome, retprice, age15to24
-   Treated unit: California (state==3)
-   Treatment period: 1989
-   Periods used to construct the synthetic control: 1980-1988

Once the synthetic control is constructed, we can compare the trends of the treated unit and the synthetic control in the post-treatment period. Any divergence in trends is interpreted as the treatment effect. In this case, we are assessing the impact of a hypothetical policy implemented in California in 1989 on cigarette sales.

```{r, echo=FALSE, message=FALSE, warning=FALSE}
library(Statamarkdown)
```

```{stata}
* Clear the workspace and turn off result pagination
clear all
set more off

* Install the 'synth' package if not already installed
*ssc install synth, replace

* Load the dataset 'smoking.dta'
use "C:\Users\maria\Desktop\RA Microeconometr√≠a\Cap4\Abadie\smoking.dta"

* Set the data as panel data with 'state' as the panel unit and 'year' as the time variable
tsset state year

* The synthetic control method seeks to construct a "synthetic control" for a treated unit (in this case, California) using a weighted combination of control units (other states). The aim is for this synthetic control to closely resemble the treated unit in the pre-treatment period based on predictor variables.

* Use the 'synth' command to construct the synthetic control for California
* - Predictor variables: cigsale from specific years, beer, lnincome, retprice, age15to24
* - Treated unit: California (state==3)
* - Treatment period: 1989
* - Periods used to construct the synthetic control: 1980-1988
synth cigsale beer lnincome retprice age15to24 cigsale(1988) cigsale(1980) cigsale(1975), ///
      trunit(3) trperiod(1989) xperiod(1980(1)1988) nested fig keep(results) replace
	  
use results.dta, clear
tsset _time

* Create the graph with a dotted line at the treatment period
twoway (tsline _Y_treated _Y_synthetic, graphregion(color(white)) lcolor(blue red) ///
    title("Cigarette Sales in California vs. Synthetic Control") ///
    legend(label(1 "California") label(2 "Synthetic California") order(1 2 3))) ///
    (function y = _Y_treated, range(1989 1989) lpattern(dash) lcolor(gs8) legend(label(3 "Tobacco Policy Change (1989)"))), ///
    ytitle("Cigarette Sales") xtitle("Year")


* Once the synthetic control is constructed, we can compare the trends of the treated unit and the synthetic control in the post-treatment period. Any divergence in trends is interpreted as the treatment effect. In this case, we are assessing the impact of a hypothetical policy implemented in California in 1989 on cigarette sales.

* Results:

* 1. The synthetic control for California is constructed using a combination of other states. Specifically, weights are assigned to states like Colorado, Connecticut, Montana, Nevada, New Mexico, and Utah.
* 2. The RMSPE (Root Mean Squared Prediction Error) is a measure of how well the synthetic control approximates California in the pre-treatment period. A lower RMSPE indicates a better fit. In this case, the RMSPE is 1.756235, suggesting a reasonably good fit.
* 3. The "Predictor Balance" table shows how California and the synthetic control compare in terms of the predictor variables. The figures show that there is a good balance between the treated unit and the synthetic control on these variables.

* The graph displays per capita cigarette sales in California and the synthetic control over time. The divergence between the two lines post-1989 represents the estimated effect of the policy.

```
